var app=function(){"use strict";function e(){}function t(e){return e()}function u(){return Object.create(null)}function r(e){e.forEach(t)}function l(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(e,t){e.appendChild(t)}function v(e,t,a){e.insertBefore(t,a||null)}function c(e){e.parentNode.removeChild(e)}function p(e,t){for(let a=0;a<e.length;a+=1)e[a]&&e[a].d(t)}function f(e){return document.createElement(e)}function y(e){return document.createTextNode(e)}function h(){return y(" ")}function E(e,t,a){null==a?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}let m;function d(e){m=e}function A(e){(function(){if(!m)throw new Error("Function called outside component initialization");return m})().$$.on_destroy.push(e)}const g=[],S=[],M=[],I=[],T=Promise.resolve();let R=!1;function C(e){M.push(e)}let N=!1;const b=new Set;function O(){if(!N){N=!0;do{for(let e=0;e<g.length;e+=1){const t=g[e];d(t),w(t.$$)}for(g.length=0;S.length;)S.pop()();for(let e=0;e<M.length;e+=1){const t=M[e];b.has(t)||(b.add(t),t())}M.length=0}while(g.length);for(;I.length;)I.pop()();R=!1,N=!1,b.clear()}}function w(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(C)}}const L=new Set;let D;function _(e,t){e&&e.i&&(L.delete(e),e.i(t))}function U(e,t,a,u){if(e&&e.o){if(L.has(e))return;L.add(e),D.c.push(()=>{L.delete(e),u&&(a&&e.d(1),u())}),e.o(t)}}function x(e,a,u){const{fragment:n,on_mount:o,on_destroy:s,after_update:v}=e.$$;n&&n.m(a,u),C(()=>{const a=o.map(t).filter(l);s?s.push(...a):r(a),e.$$.on_mount=[]}),v.forEach(C)}function P(e,t){const a=e.$$;null!==a.fragment&&(r(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function F(e,t){-1===e.$$.dirty[0]&&(g.push(e),R||(R=!0,T.then(O)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function V(t,a,n,l,o,s,v=[-1]){const i=m;d(t);const p=a.props||{},f=t.$$={fragment:null,ctx:null,props:s,update:e,not_equal:o,bound:u(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:u(),dirty:v};let y=!1;if(f.ctx=n?n(t,p,(e,a,...u)=>{const r=u.length?u[0]:a;return f.ctx&&o(f.ctx[e],f.ctx[e]=r)&&(f.bound[e]&&f.bound[e](r),y&&F(t,e)),a}):[],f.update(),y=!0,r(f.before_update),f.fragment=!!l&&l(f.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);f.fragment&&f.fragment.l(e),e.forEach(c)}else f.fragment&&f.fragment.c();a.intro&&_(t.$$.fragment),x(t,a.target,a.anchor),O()}d(i)}class B{$destroy(){P(this,1),this.$destroy=e}$on(e,t){const a=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return a.push(t),()=>{const e=a.indexOf(t);-1!==e&&a.splice(e,1)}}$set(){}}const G=Symbol("CELL"),X=Symbol("STR_ESCAPED"),Y=Symbol("STR_PLAIN"),k=Symbol("AGGREGATE"),H=Symbol("SUBTOTAL"),j=Symbol("NUMBER"),$=Symbol("COMPLEX_NUMBER"),W=Symbol("LIST"),K=Symbol("MATRIX"),q=Symbol("STRING"),Q=Symbol("ANY"),Z=Symbol("BOOLEAN"),z=Symbol("FUNCTION"),J=Symbol("ARGUMENTS"),ee=Symbol("NULL"),te=Symbol("ARRAY"),ae=Symbol("ERROR"),ue=Symbol("DATE"),re=Symbol("TIME"),ne=Symbol("DATETIME"),le=Symbol("_TRACE"),oe=Symbol("_CELL_TRACE"),se=Symbol("HYPERLINK"),ve=Symbol("#N/A"),ce=Symbol("#VALUE!"),ie=Symbol("#REF!"),pe=Symbol("#NUM"),fe=Symbol("#DIV/0!"),ye=Symbol("#NULL!"),he=Symbol("#NAME?"),Ee=Symbol("#GETTING_DATA"),me=Symbol("INLINE"),de=Symbol("HIDDEN"),Ae=Symbol("NATURAL_REFERENCE"),ge=Symbol("CIRCULAR_REFERENCE"),Se={},Me={I:1,IV:4,V:5,IX:9,X:10,XL:40,L:50,XC:90,C:100,CD:400,D:500,CM:900,M:1e3},Ie=Me,Te={...Me,LD:450,VL:45},Re={...Te,IX:9,XD:490},Ce={...Re,VD:495},Ne={...Ie,ID:499},be={"Mↁ":4e3,"ↁ":5e3,"Mↂ":9e3,"ↂ":1e4,"ↂↇ":4e4,"ↇ":5e4,"ↂↈ":9e4,"ↈ":1e5},Oe={"Ⅰ":1,"Ⅱ":2,"Ⅲ":3,"Ⅳ":4,"Ⅴ":5,"Ⅵ":6,"Ⅶ":7,"Ⅷ":8,"Ⅸ":9,"Ⅹ":10,"Ⅺ":11,"Ⅻ":12,"ⅩⅬ":40,"Ⅼ":50,"ⅩⅭ":90,"Ⅽ":100,"ⅭⅮ":400,"Ⅾ":500,"ⅭⅯ":900,"Ⅿ":1e3,...be},we=new Map([[0,Me],[1,Te],[2,Re],[3,Ce],[4,Ne],[!0,Ie],[!1,Ne],["R",Oe],["0E",{...Me,...be}],["1E",{...Te,...be,"Dↁ":4500}],["2E",{...Re,...be,"Dↁ":4500,"Cↂ":9900,"Cↁ":4900,"ↁↇ":45e3,"ↂↈ":99e3,"Mↇ":49e3}],["3E",{...Ce,...be,"Dↁ":4500,"Cↂ":9900,"Cↁ":4900,"Lↁ":4950,"ↁↇ":45e3,"ↂↈ":99e3,"Mↇ":49e3,"Dↇ":49500}],["4E",{...Ne,...be,"Dↁ":4500,"Cↂ":9900,"Cↁ":4900,"Lↁ":4950,"Xↁ":4990,"ↁↇ":45e3,"ↂↈ":99e3,"Mↇ":49e3,"Dↇ":49500,"Cↇ":49900}],["EE",{...Ne,...be,"Dↁ":4500,"Cↂ":9900,"Cↁ":4900,"Lↁ":4950,"Xↁ":4990,"Lↁ":4950,"Xↂ":9990,"Xↁ":4990,"Vↁ":4995,"Iↁ":4999,"Iↂ":9999,"Vↂ":9995,"ↁↇ":45e3,"ↂↈ":99e3,"Mↇ":49e3,"Dↇ":49500,"Cↇ":49900,"Lↇ":49950,"Xↇ":49990,"Xↈ":99990,"Lↈ":99950,"Vↇ":49995,"Iↇ":49999,"Iↈ":99999,"Vↈ":99995,IM:999,VM:995}],["R",Oe],["RE",{...Oe,"Ⅾↁ":4500,"Ⅽↂ":9900,"Ⅽↁ":4900,"Ⅼↁ":4950,"Ⅹↁ":4990,"Ⅼↁ":4950,"Ⅹↂ":9990,"Ⅹↁ":4990,"Ⅴↁ":4995,"Ⅰↁ":4999,"Ⅰↂ":9999,"Ⅴↂ":9995,"ↁↇ":45e3,"ↂↈ":99e3,"Ⅿↇ":49e3,"Ⅾↇ":49500,"Ⅽↇ":49900,"Ⅼↇ":49950,"Ⅹↇ":49990,"Ⅹↈ":99990,"Ⅼↈ":99950,"Ⅴↇ":49995,"Ⅰↇ":49999,"Ⅰↈ":99999,"Ⅴↈ":99995,"ⅠⅯ":999,"ⅤⅯ":995}]]),Le={g:1,sg:685217658567918e-19,lbm:.00220462262184878,u:602214179421676e9,ozm:.0352739619495804,grain:15.4323583529414,cwt:220462262184878e-19,shweight:220462262184878e-19,uk_cwt:196841305522212e-19,lcwt:196841305522212e-19,hweight:196841305522212e-19,stone:.00015747304441777,ton:110231131092439e-20,uk_ton:9.84206527611061e-7,LTON:9.84206527611061e-7,brton:9.84206527611061e-7},De={m:1,mi:.000621371192237334,Nmi:.000539956803455724,in:39.3700787401575,ft:3.28083989501312,yd:1.09361329833771,ang:1e10,ell:.874890638670166,ly:105700083402462e-30,parsec:324077928966473e-31,pc:324077928966473e-31,Picapt:2834.64566929134,Pica:2834.64566929134,pica:236.220472440945,survey_mi:.00062136994949495},_e={yr:.0027378507871321,day:1,d:1,hr:24,mn:1440,min:1440,sec:86400,s:86400},Ue={Pa:1,p:1,atm:986923266716013e-20,at:986923266716013e-20,mmHg:.00750063755419211,psi:.000145037737730209,Torr:.0075006168270417},xe={N:1,dyn:1e5,dy:1e5,lbf:.22480894309971,pond:101.971621297793},Pe={J:1,e:1e7,c:.239005736137667,cal:.238845896627496,eV:624150964712042e4,ev:624150964712042e4,HPh:3.72506135998619e-7,hh:3.72506135998619e-7,Wh:.000277777777777778,wh:.000277777777777778,flb:.737562149277265,BTU:.000947817120313317,btu:.000947817120313317},Fe={HP:.00134102208959503,h:.00134102208959503,PS:.0013596216173039,W:1,w:1},Ve={T:1,ga:1e4},Be={C:1,cel:1,F:33.8,fah:33.8,K:274.15,kel:274.15,Rank:493.47,Reau:.8},Ge={tsp:202884.136211058,tspm:2e5,tbs:67628.045403686,oz:33814.022701843,cup:4226.75283773038,pt:2113.37641886519,us_pt:2113.37641886519,uk_pt:1759.7539863927,qt:1056.68820943259,uk_qt:879.876993196351,gal:264.172052358148,uk_gal:219.969248299088,l:1e3,L:1e3,lt:1e3,ang3:1e30,"ang^3":1e30,barrel:6.2898107704321,bushel:28.3775932584017,ft3:35.3146667214886,"ft^3":35.3146667214886,in3:61023.7440947323,"in^3":61023.7440947323,ly3:118093498844171e-62,"ly^3":118093498844171e-62,m3:1,"m^3":1,mi3:2.39912758578928e-10,"mi^3":2.39912758578928e-10,yd3:1.30795061931439,"yd^3":1.30795061931439,Nmi3:1.57426214685811e-10,"Nmi^3":1.57426214685811e-10,Picapt3:22776990435.8706,"Picapt^3":22776990435.8706,Pica3:22776990435.8706,"Pica^3":22776990435.8706,GRT:.353146667214886,regton:.353146667214886,MTON:.882866668037215},Xe={uk_acre:.000247105381467165,us_acre:.000247104393046628,ang2:1e20,ar:.01,ft2:10.7639104167097,"ft^2":10.7639104167097,ha:1e-4,in2:1550.0031000062,"in^2":1550.0031000062,ly2:111725076312873e-46,"ly^2":111725076312873e-46,m2:1,"m^2":1,Morgen:4e-4,mi2:3.86102158542446e-7,"mi^2":3.86102158542446e-7,Nmi2:2.91553349598123e-7,"Nmi^2":2.91553349598123e-7,Picapt2:8035216.07043214,Pica2:8035216.07043214,"Pica^2":8035216.07043214,"Picapt^2":8035216.07043214,yd2:1.19599004630108,"yd^2":1.19599004630108},Ye={bit:1,byte:.125},ke={admkn:.000539611824837685,kn:.000539956803455723,"m/h":1,"m/hr":1,"m/s":.000277777777777778,"m/sec":.000277777777777778,mph:.000621371192237334},He={Yi:12089258196146292e8,Zi:11805916207174113e5,Ei:0x1000000000000000,Pi:0x4000000000000,Ti:1099511627776,Gi:1073741824,Mi:1048576,ki:1024,Y:1e24,Z:1e21,E:1e18,P:1e15,T:1e12,G:1e9,M:1e6,k:1e3,h:100,da:10,e:10,d:.1,c:.01,m:.001,u:1e-6,n:1e-9,p:1e-12,f:1e-15,a:1e-18,z:10000000000000001e-37,y:10000000000000001e-40},je={_TOSEARCHSTRING:([e,t=!0,a=!0,u=!1],r)=>new RegExp((t?"^":"")+e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/([^~](~~))*\*/g,"$1.*").replace(/([^~](~~))*\?/g,"$1.").replace(/~([?*])/g,"\\$1").replace(/~~/g,"~")+(a?"$":""),u?"":"i"),_GREATER:([e,t],a)=>e>t,_SMALLER:([e,t],a)=>e<t,_EQUAL:([e,t],a)=>e==t,_GREATER_OR_EQUAL:([e,t],a)=>a.functions._GREATER([e,t],a)||a.functions._EQUAL([e,t],a),_SMALLER_OR_EQUAL:([e,t],a)=>a.functions._SMALLER([e,t],a)||a.functions._EQUAL([e,t],a),SUM:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case ee:return e;case j:return e+a;case W:const{value:r}=t.functions.SUM(a,t);return e+r;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in SUM")}},0);return{type:j,value:a}},AVERAGE:(e,t)=>{console.log("allargs",e);const[a,u]=e.reduce(([e,a],{value:u,type:r})=>{switch(r){case ee:return[e,a];case j:return[e+u,a+1];case W:const{result:n,ccount:l}=t.functions.AVERAGE(u).meta;return[e+n,a+l];default:throw new Error("Disallowed value "+String(u)+" of type "+String(r)+" found in AVERAGE")}},[0,0]);return{type:j,value:a/u,meta:{result:a,ccount:u}}},_CELL_COUNT:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case ee:case ae:case Z:return e;case j:case ue:return e+1;case W:const{value:r}=t.functions._CELL_COUNT(a,t);return e+r;case q:return Number.isNaN(parseFloat(a))?e:e+1;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in SUM")}},0);return{type:j,value:a}},_CELL_COUNTA:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case ee:return e;case j:case ue:case q:case ae:case Z:return e+1;case W:const{value:r}=t.functions._CELL_COUNTA(a,t);return e+r;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in SUM")}},0);return{type:j,value:a}},COUNT:(e,t)=>t.functions._CELL_COUNT(e,t),COUNTA:(e,t)=>t.functions._CELL_COUNTA(e,t),COUNTBLANK:([e],t)=>{if(e.type!==W)throw new Error("COUNTA must be supplied a LIST, found value "+String(e.value)+" of type "+String(e.type));return{type:j,value:e.value.filter(({value:e,type:t})=>t===ee||""===e).length}},IF:([e,t,a],u)=>{if(e.type!==Z)throw new Error("iff must be supplied a BOOLEAN as first argument, found value "+String(e.value)+" of type "+String(e.type));return e.value?t:a},TRIM:([e],t)=>{if(e.type!==q)throw new Error("TRIM must be supplied a STRING, found value "+String(e.value)+" of type "+String(e.type));const a=e.value.trim().replace(/[ ][ ]+/g," ");return{type:q,value:a}},MAX:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case q:case ee:return e;case j:return e<a?a:e;case W:const{value:r}=t.functions.MAX(a,t);return e<r?r:e;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in MAX")}},-1/0);return{type:j,value:a}},MIN:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case q:case ee:return e;case j:return e>a?a:e;case W:const{value:r}=t.functions.MIN(a,t);return e>r?r:e;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in MIN")}},1/0);return{type:j,value:a}},CONCATENATE:(e,t)=>({type:q,value:e.map(e=>e.value||"").join("")}),SUBSTITUTE:([{value:e},{value:t},{value:a},{value:u}={}],r)=>{let n=0;return{type:q,value:e.replace(new RegExp(t,"g"),u?(e,t,r)=>(n++,n==u?a:e):a)}},VALUE:([e],t)=>({type:j,value:parseFloat(e.value)}),EXACT:([e,t],a)=>({type:Z,value:e.value===t.value&&e.type===t.type}),UPPER:([e],t)=>({type:q,value:e.value.toUpperCase()}),LOWER:([e],t)=>({type:q,value:e.value.toLowerCase()}),PROPER:([e],t)=>({type:q,value:e.value.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),LEFT:([{value:e},{value:t=1}={numChars:1}],a)=>({type:q,value:e.slice(0,t)}),RIGHT:([{value:e},{value:t=1}={numChars:1}],a)=>({type:q,value:e.slice(e.length-t)}),MID:([{value:e},{value:t},{value:a}],u)=>({type:q,value:e.slice(t,t+a)}),AND:(e,t)=>({type:Z,value:e.reduce((e,t)=>t.value&&e,!0)}),OR:(e,t)=>({type:Z,value:e.reduce((e,t)=>t.value||e,!0)}),XOR:(e,t)=>({type:Z,value:e.reduce((e,t)=>t.value&&!e||!t.value&&e,!1)}),NOT:([e],t)=>({type:Z,value:!e.value}),IFERROR:([e,t],a)=>e.type===ae?t:e,IFNA:([e,t],a)=>e.type===ae&&e.value===ve?t:e,SUMPRODUCT:([{value:e},...t],a)=>t.every(t=>t.value.length===e.length)?{type:j,value:e.reduce((e,{value:a},u)=>e+t.reduce((e,{value:t})=>t[u].value*e,a),0)}:{type:ae,value:ce},RAND:()=>({type:j,value:Math.random()}),RANDBETWEEN:([{value:e},{value:t}],a)=>({type:j,value:Math.floor(Math.random()*(t-e+1)+e)}),ROUND:([{value:e},{value:t}],a)=>({type:j,value:t<0?Math.round(e*Math.pow(10,t))*Math.pow(10,-t):Math.round(e*Math.pow(10,t))/Math.pow(10,t)}),ROUNDUP:([{value:e},{value:t}],a)=>({type:j,value:Math.ceil(e*Math.pow(10,t))/Math.pow(10,t)}),ROUNDDOWN:([{value:e},{value:t}],a)=>({type:j,value:Math.floor(e*Math.pow(10,t))/Math.pow(10,t)}),MROUND:([{value:e},{value:t}],a)=>({type:j,value:t*Math.round(e/t)}),FLOOR:([{value:e},{value:t}],a)=>({type:j,value:t*Math.floor(e/t)}),CEILING:([{value:e},{value:t}],a)=>({type:j,value:t*Math.ceil(e/t)}),INT:([{value:e},{value:t}],a)=>({type:j,value:Math.floor(e)}),TRUNC:([{value:e},{value:t}],a)=>{const u=(e+"").match(new RegExp("(\\d+\\.\\d{"+t+"})(\\d)"));return{type:j,value:u?parseFloat(u[1]):e}},EVEN:([{value:e}],t)=>({type:j,value:2*Math.round(e/2)}),ODD:([{value:e}],t)=>({type:j,value:e<0?2*Math.ceil(e/2)-1:2*Math.floor(e/2)+1}),MOD:([{value:e},{value:t}],a)=>({type:j,value:e-t*Math.floor(e/t)}),SMALL:([{value:e},{value:t}],a)=>({type:j,value:e.sort(({value:e},{value:t})=>e-t)[t-1]}),LARGE:([{value:e},{value:t}],a)=>({type:j,value:e.sort(({value:e},{value:t})=>t-e)[t-1]}),COUNTIF:([{value:e,type:t},{value:a,type:u}],r)=>{if(t!==W)throw new Error("COUNTIF must be supplied a LIST, found value "+String(value)+" of type "+String(t));const n=r.functions._CRITMATCHER([{value:a,type:u}],r);return{type:j,value:e.filter(n).length}},_CRITMATCHER:([{value:e,type:t}],a)=>{if(t!==q){const t=({value:t})=>t==e;return t.criterium=e,t}const u={">=":t=>t>=parseFloat(e.substring(2)),"<=":t=>t<=parseFloat(e.substring(2)),"<>":t=>t!=parseFloat(e.substring(2))}[e.substring(0,2)]||{">":t=>t>parseFloat(e.substring(1)),"<":t=>t<parseFloat(e.substring(1)),"=":t=>t==parseFloat(e.substring(1))||""+t===e.substring(1)}[e.substring(0,1)];if(u){const t=({value:e})=>u(e);return t.criterium=e,t}const r=a.functions._TOSEARCHSTRING([e]),n=({value:e})=>r.test(e);return n.criterium=e,n},COUNTIFS:(e,t)=>{if(e.length<2)throw new Error("Excepted 'criteria_range1, criteria1', but found "+(e.length?"'criteria_range1'":"no arguments"));if(e.length%2)throw new Error("Wrong number of arguments, excepted 'criteria_range1, criteria1, [criteria_range2, criteria2]...', but found "+e.map((e,t)=>t%2?"criteria"+Math.ceil((t+1)/2):"criteria_range"+Math.ceil((t+1)/2)).join(", "));const[a,u]=e.reduce(([e,t],a,u)=>u%2?[e,[...t,a]]:[[...e,a],t],[[],[]]);if(!a.every((e,t,a)=>e.length===a[0].length))throw new Error("All defined ranges need to have the same length");const r=u.map(({value:e,type:a})=>t.functions._CRITMATCHER([{value:e,type:a}],t));return{type:j,value:a[0].value.reduce((e,t,u)=>e+a.every(({value:e},t)=>r[t](e[u])),0)}},VLOOKUP:([e,t,a,u={type:Z,value:!0}],r)=>{if(t.type===W&&(t={type:K,value:[t.value]}),t.type!==K)throw new Error("Expected table_array to be a MATRIX but found "+String(t.value)+" ("+String(t.type)+")");const n=t.value[0].findIndex(t=>e.value==t.value||e.type===q&&t.type===q&&e.value.toLowerCase()===t.value.toLowerCase());if(n>-1)return t.value[a.value-1][n];if(!u.value)return{type:ae,value:ve};const l=[].concat(t.value[0]),{_GREATER:o}=r.functions;let s={type:ae,value:ve};for(;l.length;){if(o(l[0].value,e.value))return s;const u=t.value[0].length-l.length;s=t.value[a.value-1][u],l.shift()}return s},INDEX:([e,{value:t},{value:a}={value:1}],u)=>{if(e.type===W&&(e={type:K,value:[e.value]}),e.type!==K)throw new Error("Expected table_array to be a MATRIX but found "+String(e.value)+" ("+String(e.type)+")");return e.value[t-1][a-1]},MATCH:([e,t,{value:a}={type:j,value:1}],u)=>{if(table_array.type!==W)throw new Error("Expected table_array to be a LIST but found "+String(table_array.value)+" ("+String(table_array.type)+")");if(-1===[-1,0,1,"-1","0","1"].indexOf(a))throw new Error("Expected match_type to be one of [-1,0,1] but found "+String(a.value)+" ("+String(a.type)+")");const r=table_array.value.findIndex(t=>e.value==t.value||e.type===q&&t.type===q&&e.value.toLowerCase()===t.value.toLowerCase());if(r>-1)return table_array.value[r];if(0===a||"0"===a)return{type:ae,value:ve};const n=[].concat(table_array.value[0]);let l={type:ae,value:ve};const{_GREATER:o,_SMALLER:s}=u.functions;for(;n.length;){if((1===a||"1"===a)&&o(n[0].value,e.value))return l;if((-1===a||"-1"===a)&&s(n[0].value,e.value))return l;const t=table_array.value[0].length-n.length;l=table_array.value[col_index_num.value-1][t],n.shift()}return l},INDIRECT:([e,t={value:!0,type:Z}],a)=>{const u=a.parser(e.value,a);return u||{type:ae,value:ie}},OFFSET:([e,{value:t},{value:a},u={},r={}],n)=>{let l=e;if(e.type===K&&(l=e.value[0][0]),e.type===W&&(l=e.value[0]),l.meta.type!==G)throw new Error("Expected CELL, LIST<CELL> or MATRIX<CELL> as first argument of OFFSET, found "+String(e.value)+" ("+String(e.type)+") /"+String(l.value)+" ("+String(l.meta.type)+")");const o=l.meta.row+t,s=l.meta.col+a,v=u.value||e.rowspan||1,c=r.value||e.colspan||1,i=[];let p=!1;for(let e=o;e<=o+v-1;e++){const t=[];for(let a=s;a<=s+c-1;a++){const u=context.getRow(e-1).getCol(a-1)||{value:ie,type:ae};u||(p=!0),t.push({...u,meta:{type:G,row:e,col:a}})}i.push(t)}return p?{type:ae,value:ie,meta:{partial_results:i}}:1===i.length&&i.every(e=>1===e.length)?i[0][0]:1===i.length?{type:W,value:i[0],rowspan:1,colspan:i[0].length}:i.every(e=>1===e.length)?{type:W,value:i.map(e=>e[0]),rowspan:i.length,colspan:1}:{type:K,value:i,get rowspan(){return i.length},get colspan(){return i[0].length}}},TRANSPOSE:([e],t)=>{console.log("array",e);const{col:a,row:u}=t.currentcell;if(e.type===W)return{values:e.value.map((t,r)=>({row:u+(e.colspan>1?r:0)+1,col:a+(e.rowspan>1?r:0)+1,value:t})),type:te};if(e.type===K){const t=e.value[0].map((t,r)=>e.value.map((e,t)=>({row:u+r+1,col:a+t+1,value:e[r]})));return{type:te,value:t,get rowspan(){return t.length},get colspan(){return t[0].length}}}throw new Error("Expected LIST or MATRIX as first argument to TRANSPOSE, found "+String(e.value)+" ("+String(e.type)+")")},HYPERLINK:([{value:e},{value:t}],a)=>({type:se,meta:{href:e},value:t||e}),FV:([{value:e},{value:t},{value:a}={value:0},{value:u}={value:0},{value:r}={value:0}],n)=>0===e?{type:j,value:0-u-a*t}:{type:j,value:0-(u*Math.pow(1+e,t)+a*(1+e*r)*(Math.pow(1+e,t)-1)/e)},DATE:([{value:e},{value:t},{value:a}],u)=>({type:ue,meta:{YEAR:e,MONTH:t,DAY:a},value:new Date(e,t-1,a)}),DATEVALUE:([{value:e}],t)=>({type:ue,value:new Date(e)}),TODAY:([],e)=>({type:ue,value:new Date}),NOW:(e,t)=>({type:ne,value:new Date}),DAY:([{value:e}],t)=>({type:j,value:e.getDate()}),MONTH:([{value:e}],t)=>({type:j,value:e.getMonth()}),YEAR:([{value:e}],t)=>({type:j,value:e.getFullYear()}),EOMONTH:([{value:e},{value:t}={value:0}],a)=>({type:j,value:new Date(e.getFullYear(),e.getMonth()+1+t,0).getDate()}),WEEKDAY:([{value:e,type:t},{value:a}={value:1}],u)=>{const r={1:e=>e+1,2:e=>(e+7-1)%7+1,3:e=>(e+7-1)%7,11:e=>(e+7-1)%7+1,12:e=>(e+6-1)%7+1,13:e=>(e+5-1)%7+1,14:e=>(e+4-1)%7+1,15:e=>(e+3-1)%7+1,16:e=>(e+2-1)%7+1,17:e=>e+1};return t===j?{type:j,meta:{return_type:a+""},value:r[a+""](e-1)}:{type:j,meta:{return_type:a+""},value:r[a+""](e.getDay())}},WEEKNUM:([{value:e},{value:t}={value:1}],a)=>{if(21===t){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),a=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-a);const u=new Date(Date.UTC(t.getUTCFullYear(),0,1));return{type:j,value:Math.ceil(((t-u)/864e5+1)/7)}}const u={1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0},r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),n=r.getUTCDay()||7;r.setUTCDate(r.getUTCDate()+u[t]-n);const l=new Date(Date.UTC(r.getUTCFullYear(),0,1)),o=r.getUTCDay()||7;return l.setUTCDate(l.getUTCDate()+u[t]-o),{type:j,value:Math.ceil(((r-l)/864e5+1)/7)}},DATEDIF:([{value:e},{value:t},{value:a}],u)=>t<e?{type:ae,value:pe}:{type:j,value:{Y:(e,t)=>Math.ceil(Math.abs(t-e)/31556952e3),M:(e,t)=>Math.ceil(Math.abs(t-e)/2629746e3),D:(e,t)=>Math.ceil(Math.abs(t-e)/864e5),MD:(e,t)=>t.getDate()-e.getDate(),YM:(e,t)=>t.getMonth()-e.getMonth(),YD:(e,t)=>(t.setUTCDate(2019),e.setUTCDate(2019),Math.ceil(Math.abs(t-e)/864e5))}[a](new Date(e.valueOf()),new Date(t.valueOf()))},EDATE:([{value:e},{value:t}],a)=>{const u=new Date(e.valueOf());return u.setMonth(e.getMonth()+t),{type:ue,value:u}},YEARFRAC:([{value:e},{value:t},{value:a}={value:0}],u)=>{const r={0:(e,t)=>{const a=new Date(e.getFullYear(),e.getMonth()+1,0).valueOf()===e.valueOf(),u=new Date(t.getFullYear(),t.getMonth()+1,0).valueOf()===t.valueOf();let r=e.getFullYear(),n=t.getFullYear(),l=e.getMonth(),o=t.getMonth(),s=e.getDate(),v=t.getDate();return a&&u&&(v=30),a&&(s=30),31===v&&s>=30&&(v=30),31===s&&(s=30),{type:j,value:(360*(n-r)+30*(o-l)+(v-s))/360}},1:(e,t)=>{let a=Math.min(e.getFullYear(),t.getFullYear());const u=Math.max(e.getFullYear(),t.getFullYear());let r=365;for(;a<=u;){if(a%400==0||a%100!=0&&a%4==0){r=366;break}a++}return{type:j,value:Math.abs(t-e)/864e5/r}},"Actual/actual":(e,t)=>r[1](e,t),2:(e,t)=>({type:j,value:Math.abs(t-e)/864e5/360}),"Actual/360":(e,t)=>r[2](e,t),3:(e,t)=>({type:j,value:Math.abs(t-e)/864e5/365}),"Actual/365":(e,t)=>r[3](e,t),4:(e,t)=>{let a=e.getFullYear(),u=t.getFullYear(),r=e.getMonth(),n=t.getMonth(),l=e.getDate(),o=t.getDate();return 31===o&&(o=30),31===l&&(l=30),{type:j,value:(360*(u-a)+30*(n-r)+(o-l))/360}},"European 30/360":(e,t)=>r[4](e,t),"30/360":(e,t)=>{let a=e.getFullYear(),u=t.getFullYear(),r=e.getMonth(),n=t.getMonth(),l=e.getDate(),o=t.getDate();return{type:j,value:(360*(u-a)+30*(n-r)+(o-l))/360}},"30/360 Bond Basis":(e,t)=>{let a=e.getFullYear(),u=t.getFullYear(),r=e.getMonth(),n=t.getMonth(),l=e.getDate(),o=t.getDate();return l=Math.min(l,30),l>=30&&(o=Math.min(o,30)),{type:j,value:(360*(u-a)+30*(n-r)+(o-l))/360}},"30A/360":(e,t)=>r["30/360 Bond Basis"](e,t),"30/360 US":(e,t)=>r[0](e,t),"30U/360":(e,t)=>r[0](e,t),"30/360":(e,t)=>{let a=e.getFullYear(),u=t.getFullYear(),r=e.getMonth(),n=t.getMonth(),l=e.getDate(),o=t.getDate();return{type:j,value:(360*(u-a)+30*(n-r)+(o-l))/360}},"30E/360":(e,t)=>r[4](e,t),"30/360 ICMA":(e,t)=>r[4](e,t),"30S/360":(e,t)=>r[4](e,t),"Eurobond basis (ISDA 2006)":(e,t)=>r[4](e,t),"Special German":(e,t)=>r[4](e,t),"30E/360 ISDA":(e,t)=>{let a=e.getFullYear(),u=t.getFullYear(),r=e.getMonth(),n=t.getMonth(),l=e.getDate(),o=t.getDate();return l===new Date(t.getFullYear(),t.getMonth()+1,0).getDate()&&(l=30),o===new Date(e.getFullYear(),e.getMonth()+1,0).getDate()&&(o=30),{type:j,value:(360*(u-a)+30*(n-r)+(o-l))/360}},"Eurobond basis (ISDA 2000)":(e,t)=>r["30E/360 ISDA"](e,t),"Actual/Actual ISDA":(e,t)=>{let a=Math.min(e.getFullYear(),t.getFullYear());const u=Math.max(e.getFullYear(),t.getFullYear());let r=0,n=0;for(;a<=u;){const u=Math.max(new Date(a,1,1),e),l=Math.min(new Date(a+1,1,0),t),o=Math.ceil(Math.abs(l-u)/864e5);a%400==0||a%100!=0&&a%4==0?r+=o:n+=o,a++}return{type:j,value:r/366+n/365}},"Actual/Actual":(e,t)=>r["Actual/Actual ISDA"](e,t),"Act/Act":(e,t)=>r["Actual/Actual ISDA"](e,t),"Actual/365":(e,t)=>r["Actual/Actual ISDA"](e,t),"Act/365":(e,t)=>r["Actual/Actual ISDA"](e,t),"Act/365 Fixed":(e,t)=>r["Actual/365"](e,t),"A/365 Fixed":(e,t)=>r["Actual/365"](e,t),"A/365F":(e,t)=>r["Actual/365"](e,t),English:(e,t)=>r["Actual/365"](e,t),"Act/360":(e,t)=>r["Actual/360"](e,t),"A/360":(e,t)=>r["Actual/360"](e,t),French:(e,t)=>r["Actual/360"](e,t),"Actual/364":(e,t)=>({type:j,value:Math.abs(t-e)/864e5/364}),"Actual/Actual AFB":(e,t)=>{const a=new Date(e.valueOf()),u=a.getFullYear(),r=new Date(t.valueOf());let n=0;for(;r.getFullYear()>a.getFullYear();)n++,r.setFullYear(r.getFullYear()-1);r.setFullYear(r.getFullYear()+1);const l=u%400==0||u%100!=0&&u%4==0?366:365;return{type:j,value:n-1+Math.abs(r-a)/864e5/l,meta:{years:n-1,days:Math.abs(r-a)/864e5}}},"1/1":(e,t)=>{let a=e.getFullYear(),u=t.getFullYear(),r=e.getMonth(),n=t.getMonth(),l=e.getDate(),o=t.getDate();return{type:j,value:(360*(u-a)+30*(n-r)+(o-l))/365.25}}};return r[a+""](e,t)},WORKDAY:([{value:e},{value:t},a])=>{let u=0;const r=new Date(e.valueOf()),n=a&&a.type===W?a.value.map(e=>e.value):[];for(;u<t;){r.setDate(r.getDate()+1);const e=r.getDay();0!==e&&6!==e&&(n.some(e=>e.valueOf()===r.valueOf())||u++)}return{type:ue,value:r}},"WORKDAY.INTL":([{value:e},{value:t},a={value:1},u={value:[]}])=>{let r=0;const n=new Date(e.valueOf());let l=[6,0];const o={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};if(a.type===W&&(l=a.value.map(({value:e})=>e).filter(e=>e<7)),"7"===(a.value+"").length&&(l=a.value.split("").map((e,t)=>"1"===e?(t+1)%7:-1).filter(e=>-1!==e)),o[a.value+""]&&(l=o[a.value+""]),o.length>=7)return{type:ae,value:ce,meta:{message:"Invalid value for 'weekend' "+String(a)+": Can't exclude all weekdays!"}};const s=u&&u.type===W?u.value.map(e=>e.value):[];for(;r<t;){n.setDate(n.getDate()+1);const e=n.getDay();l.indexOf(e)>-1||(s.some(e=>e.valueOf()===n.valueOf())||r++)}return{type:ue,value:n}},NETWORKDAYS:([{value:e},{value:t},a])=>{let u=0;const r=new Date(e.valueOf()),n=a&&a.type===W?a.value.map(e=>e.value):[];for(;r<t;){r.setDate(r.getDate()+1);const e=r.getDay();0!==e&&6!==e&&(n.some(e=>e.valueOf()===r.valueOf())||u++)}return{type:j,value:u}},"NETWORKDAYS.INTL":([{value:e},{value:t},a={value:1},u={value:[]}])=>{let r=0;const n=new Date(e.valueOf());let l=[6,0];const o={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};if(a.type===W&&(l=a.value.map(({value:e})=>e).filter(e=>e<7)),"7"===(a.value+"").length&&(l=a.value.split("").map((e,t)=>"1"===e?(t+1)%7:-1).filter(e=>-1!==e)),o[a.value+""]&&(l=o[a.value+""]),"1111111"===o.length)return{type:j,value:0,meta:{message:"Shortcut for trivial value '1111111'"}};const s=u&&u.type===W?u.value.map(e=>e.value):[];for(;n<t;){n.setDate(n.getDate()+1);const e=n.getDay();l.indexOf(e)>-1||(s.some(e=>e.valueOf()===n.valueOf())||r++)}return{type:j,value:r}},TIME:([{value:e},{value:t},{value:a}])=>({type:re,value:new Date(1970,1,1,e,t,a,0)}),TIMEVALUE:([{value:e}])=>({type:re,value:new Date(e)}),NOW:()=>({type:re,value:new Date}),HOUR:([{value:e}])=>({type:j,value:e.getHours()}),MINUTE:([{value:e}])=>({type:j,value:e.getMinutes()}),SECOND:([{value:e}])=>({type:j,value:e.getSeconds()}),ABS:([{value:e}])=>({type:j,value:Math.abs(e)}),ACCRINT:([{value:e},{value:t},{value:a},{value:u},{value:r}={value:1e3},{value:n},{value:l}={value:0},{value:o}={value:!0}],s)=>(e=Math.floor(e),t=Math.floor(t),a=Math.floor(a),n=Math.floor(n),l=Math.floor(l),u<=0?{type:ae,value:pe,meta:{message:"'rate' must be >=0, but is "+String(u)}}:r<=0?{type:ae,value:pe,meta:{message:"'par' must be >=0, but is "+String(r)}}:1!==n&&2!==n&&4!==n?{type:ae,value:pe,meta:{message:"'frequency' must be 1,2 or 4, but is "+String(r)}}:l<0||l>4?{type:ae,value:pe,meta:{message:"'basis' must be >0 and <4, but is "+String(l)}}:e>a?{type:ae,value:pe,meta:{message:"'issue' must be >= 'settlement', but is "+String(e)+"<"+String(a)}}:{type:ae,value:"NOT IMPLEMENTED"}),ACCRINTM:([{value:e}])=>({type:ae,value:"NOT IMPLEMENTED"}),ACOS:([{value:e}])=>({type:j,value:Math.acos(e)}),ACOSH:([{value:e}])=>({type:j,value:Math.acosh(e)}),ACOT:([{value:e}],t)=>t.functions.ATAN(1/e),ACOTH:([{value:e}])=>_context.functions.ATANH(1/e),AGGREGATE:([{value:e},{value:t=0}={value:0},...a],u)=>{const r={1:"AVERAGE",2:"COUNT",3:"COUNTA",4:"MAX",5:"MIN",6:"PRODUCT",7:"STDEV.S",8:"STDEV.P",9:"SUM",10:"VAR.S",11:"VAR.P",12:"MEDIAN",13:"MODE.SNGL",14:"LARGE",15:"SMALL",16:"PERCENTILE.INC",17:"QUARTILE.INC",18:"PERCENTILE.EXC",19:"QUARTILE.EXC"},n=u.functions[r[e+""]],l=a.filter(({type:e,value:a,meta:u={}})=>{switch(t+""){case"1":return!u.hidden&&u.type!==k&&u.type!==H;case"2":return e!==ae&&u.type!==k&&u.type!==H;case"3":return!u.hidden&&e!==ae&&u.type!==k&&u.type!==H;case"4":return!0;case"5":return!u.hidden;case"6":return e!==ae;case"7":return!u.hidden&&e!==ae;case"0":return u.type!==k&&u.type!==H;default:throw new Error("'AGGREGATE's 'options' must be between 0 and 7, but found "+String(t))}});try{return{...n(l,u),meta:{type:k}}}catch(t){const a=l.find(e=>e&&e.type===ae);return{type:ae,value:a&&a.value||t.name+" in "+r[e+""]+': "'+t.message+'"',meta:{error_value:a,internal_error:t}}}},ADDRESS:([{value:e},{value:t},{value:a}={value:1},{value:u}={value:!0},{value:r}={}],n)=>n.parser((r?"'"+r+"'!":"")+(u?(1===a||3===a?"$":"")+String.fromCharCode(t+64)+(1===a||2===a?"$":"")+e:"R"+(1===a||2===a?"["+e+"]":e)+"C"+(1===a||3===a?"["+t+"]":t))),AMORDEGRC:([{value:e}])=>({type:ee,value:e}),AMORLINC:([{value:e}])=>({type:ee,value:e}),ARABIC:([{value:e}])=>({type:j,value:function(e){if(null==e)return-1;for(var t=0,a=0,u=0,r=0;r<e.length;r++){var n={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3,...be,...Oe}[e.charAt(r)];n>u&&(t-=2*a),n!==u&&(a=0),a+=n,t+=n,u=n}return t}(e)}),AREAS:([{value:e,type:t}])=>({type:j,value:t===J?e.length:[W,te].includes(t)?1:0}),ASC:([{value:e}])=>({type:q,value:e.split("").map(e=>e.charCodeAt(0)>=65248?String.fromCharCode(e.charCodeAt(0)-65248):e).join("")}),ASIN:([{value:e}])=>({type:j,value:Math.asin(e)}),ASINH:([{value:e}])=>({type:j,value:Math.asinh(e)}),ATAN:([{value:e}])=>({type:j,value:Math.atan(e)}),ATAN2:([{value:e},{value:t}])=>({type:j,value:Math.atan2(e,t)}),ATANH:([{value:e}])=>({type:j,value:Math.atanh(e)}),AVEDEV:(e,t)=>{let a=e;const[{type:u,value:r}]=a;u===W&&(a=r);const n=a.some(({type:e})=>e!==j);if(n)return{type:ae,value:"AVEDEV exspects either numbers or a list of numbers as arguments, but found "+String(n.value)+" ("+String(n.type)+")"};const{value:l}=t.functions.AVERAGE(a),o=a.map(({value:e})=>Math.abs(l-e));return{type:j,value:o.reduce((e,t)=>e+t,0)/o.length,meta:{avg:l,length:o.length,deviations:o}}},AVERAGEA:e=>{const t=e.reduce((e,{value:t,type:a})=>{switch(a){case ee:return e;case j:return e+t;case W:return t.reduce((e,t)=>{if(t.type!==j)throw new Error("Disallowed value "+String(t.value)+" of type "+String(t.type)+" found in LIST supplied to SUM");return e+t.value},e);case Z:return e+ +t;case q:return e;default:throw new Error("Disallowed value "+String(t)+" of type "+String(a)+" found in AVERAGEA")}},0);return{type:j,value:t/e.length}},AVERAGEIF:(e,t)=>({type:j,value:t.function.SUMIF(e).value/t.functions.COUNTIF(e).value}),AVERAGEIFS:([e,...t],a)=>({type:j,value:a.function.SUMIFS([e,...t]).value/a.functions.COUNTIFS(t).value}),BAHTTEXT:([{value:e}])=>({type:q,value:new Intl.NumberFormat("th-TH-u-nu-thai",{numberingSystem:"thai",style:"currency",currency:"THB"}).format(e)}),BASE:([{value:e},{value:t},{value:a}={value:0}])=>({type:q,value:e.toString(t).padStart(a,"0").toUpperCase()}),_BESSEL:([{value:e,type:t},{value:a,typeNT:u},{value:r}],n,l)=>{if(NT!==j||t!=j)return{TYPE:ae,VALUE:ce};if(a<0)return{TYPE:ae,VALUE:ve};const o=Se[l]||Se[r]||Se["bessel"+r];if(!o)throw new Error("ILLEGAL INVOCATION, expected bessel to be i, j, k or y but found "+String(l||r));return{TYPE:j,value:o(e,Math.floor(a))}},BESSEL:(e,t)=>t.functions._BESSEL(e,t),BESSELI:(e,t)=>t.functions._BESSEL(e,t,"besseli"),BESSELJ:(e,t)=>t.functions._BESSEL(e,t,"besselj"),BESSELK:(e,t)=>t.functions._BESSEL(e,t,"besselk"),BESSELY:(e,t)=>t.functions._BESSEL(e,t,"bessely"),BETADIST:([{value:e},{valye:t},{value:a},{value:u}={value:0},{value:r}={value:1}])=>({type:j,value:"NOT IMPLEMENTED"}),"BETA.DIST":([{value:e},{valye:t},{value:a},{value:u},{value:r}={value:0},{value:n}={value:1}])=>({type:j,value:"NOT IMPLEMENTED"}),BETAINV:([{value:e},{valye:t},{value:a},{value:u}={value:0},{value:r}={value:1}])=>({type:j,value:"NOT IMPLEMENTED"}),"BETA.INV":(e,t)=>t.functions.BETAINV(e,t),BIN2DEC:([{value:e}])=>({type:j,value:parseInt(e,2).toString(10)}),BIN2HEX:([{value:e},{value:t}])=>({type:q,value:parseInt(e,2).toString(16).padStart(t,"0")}),BIN2OCT:([{value:e},{value:t}])=>({type:q,value:parseInt(e,2).toString(8).padStart(t,"0")}),BINOMDIST:([{value:e},{value:t},{value:a},{value:u}])=>({type:j,value:"NOT IMPLEMENTED"}),"BINOM.DIST":(e,t)=>t.functions.BINOMDIST(e,t),"BINOM.DIST.RANGE":([{value:e},{value:t},{value:a},{value:u}],r)=>{let n=0;for(let l=a;l<=u;l++)n+=r.BINOMDIST([{value:l},{value:e},{value:t},{value:!1}],r).value;return{type:j,value:n}},"BINOM.INV":([{value:e},{value:t},{value:a}],u)=>{for(let r=0;r<1e7;r++)if(u.BINOMDIST([{value:r},{value:e},{value:t},{value:!1}],u).value>=a)return{type:j,value:r};return{type:ae,value:"No value found"}},BITAND:([{value:e},{value:t}])=>({type:j,value:e&t}),BITLSHIFT:([{value:e},{value:t}])=>({type:j,value:e<<t}),BITOR:([{value:e},{value:t}])=>({type:j,value:e|t}),BITRSHIFT:([{value:e},{value:t}])=>({type:j,value:e>>t}),BITXOR:([{value:e},{value:t}])=>({type:j,value:e^t}),CALL:([{value:e,type:t},...a],u)=>{if(console.log(u),!u.allowUnsafe)throw new Error("[SECURITY VIOLATION] Attempted to call 'call', but 'allowUnsafe'-option is not true");if(t===z){const t=e(a.map(({value:e})=>e));return{type:t&&t.type||Q,value:t}}const[r,n]=[[u.functions[e],"_context.functions"],[u[e],"_context"],[(self||global||window)[e],"global"]].find(([e])=>!!e)||[];if(r){if("function"!=typeof r)return{type:ee||Q,value:r,meta:{type:n}};const e=r(a),t=e[oe]||[];return{type:e&&e.type||Q,value:e&&e.value||e,[oe]:t}}try{const t=a.map((e,t)=>String.fromCharCode(97+t)),u=a.map(e=>e.value||e),r=new Function(...t,e);return{type:r&&r.type||Q,value:r(...u),meta:{exec:r}}}catch(t){return{type:ae,value:"Failed to call function "+e,meta:{f:e,args:a,error:t}}}},"CEILING.MATH":([{value:e},{value:t},{value:a}],u)=>1===a&&e<0?{type:j,value:t*Math.floor(e/t)}:{type:j,value:t*Math.ceil(e/t)},"CEILING.PRECISE":([{value:e},{value:t}])=>({type:j,value:e&&t?t*Math.floor(e/t):0}),CELL:([{value:e},t],a)=>{const{value:u,type:r,meta:n}=t||{meta:{type:G,row:a.currentcell.row,col:a.currentcell.col}};if(u&&n.type!==G)return{type:ae,value:"CELL function's second argument must be a cell if provided. Found "+n.type+" instead"};const{row:l,col:o}=n;switch(e.toLowerCase()){case"address":return{type:q,value:"$"+String.fromCharCode(64+l+1)+"$"+(o+1),meta:{CELL_FUNCTION:"address"}};case"col":return{type:j,value:o+1,meta:{CELL_FUNCTION:"col"}};case"color":return{type:j,value:0,meta:{error:"CELL(color) not supported",CELL_FUNCTION:"color"}};case"contents":return{type:r,value:u,meta:{...n,CELL_FUNCTION:"contents"}};case"filename":return{type:q,value:""+window.location,meta:{CELL_FUNCTION:"filename"}};case"format":return{type:q,value:"G",meta:{error:"CELL(format) not supported",CELL_FUNCTION:"format"}};case"parentheses":return{type:j,value:0,meta:{error:"CELL(parentheses) not supported",CELL_FUNCTION:"parentheses"}};case"prefix":return{type:q,value:"",meta:{error:"CELL(prefix) not supported",CELL_FUNCTION:"prefix"}};case"protect":return{type:j,value:0,meta:{error:"CELL(protect) not supported",CELL_FUNCTION:"protect"}};case"row":return{type:j,value:l+1,meta:{CELL_FUNCTION:"row"}};case"type":return null===r?{type:q,value:"b",meta:{CELL_FUNCTION:"type"}}:r===q?{type:q,value:"l",meta:{CELL_FUNCTION:"type"}}:{type:q,value:"v",meta:{CELL_FUNCTION:"type"}};case"width":return{type:j,value:0,meta:{error:"CELL(width) not supported",CELL_FUNCTION:"width"}};default:return{type:ae,value:"Unknown info_type "+e+" supplied to CELL"}}},CHAR:([{value:e}])=>({type:q,value:String.fromCharCode(e)}),CHIDIST:([{value:e}])=>({type:ee,value:e}),CHIINV:([{value:e}])=>({type:ee,value:e}),CHITEST:([{value:e}])=>({type:ee,value:e}),"CHISQ.DIST":([{value:e}])=>({type:ee,value:e}),"CHISQ.DIST.RT":([{value:e}])=>({type:ee,value:e}),"CHISQ.INV":([{value:e}])=>({type:ee,value:e}),"CHISQ.INV.RT":([{value:e}])=>({type:ee,value:e}),"CHISQ.TEST":([{value:e}])=>({type:ee,value:e}),CHOOSE:([{value:e},...t])=>({...t[e-1]}),CLEAN:([{value:e}])=>({type:q,value:e.replace(/[\x00-\x1F]/g,"")}),CODE:([{value:e}])=>({type:j,value:e.charCodeAt(0)}),COLUMN:([{value:e,type:t,meta:a={}}={}],u)=>{if(!e)return{type:j,value:u.currentcell.col+1};if(a.type===G)return{type:j,value:a.col};throw new Error("COLUMN's first argumnet must be a cell-reference (meta.type=CELL)! Found "+String(e)+" ("+String(t)+"/"+String(a.type)+")")},COLUMNS:([{value:e,type:t}])=>{if(t===W){const{meta:{type:t,col:a}={}}=e[0],{meta:{type:u,col:r}={}}=e[e.length-1];return t===G&&u===G?{type:j,value:r-a+1}:{type:j,value:e.length}}if(t===K)return{type:j,value:e[0].length};throw new Error("COLUMNS must be called with LIST or MATRIX. Found "+String(e)+" ("+String(t)+")")},_FACTORIAL_CACHE:[1,1],_FACTORIAL_i:2,_FACTORIAL:([{value:e}],t)=>{if(void 0!==t.functions._FACTORIAL_CACHE[e])return t.functions._FACTORIAL_CACHE[e];let a=t.functions._FACTORIAL_CACHE[Number(t.functions._FACTORIAL_i-1)];for(;t.functions._FACTORIAL_i<=e;t.functions._FACTORIAL_i++)t.functions._FACTORIAL_CACHE[t.functions._FACTORIAL_i]=a*=t.functions._FACTORIAL_i;return a},COMBIN:([e,t],a)=>({type:j,value:a.functions._FACTORIAL([e],a)/a.functions._FACTORIAL([t],a)/a.functions._FACTORIAL([{type:j,value:e.value-t.value}],a)}),COMBINA:([{value:e},{value:t}],a)=>a.functions.COMBIN([{value:e+t-1,type:j},{value:e-1,type:j}],a),COMPLEX:([{value:e,type:t},{value:a,type:u},{value:r}={value:"i"}])=>"i"!==r&&"j"!==r?{type:ae,value:ce,meta:{error:"Suffix supplied to COMPLEX must be either 'i' or 'j', but found "+String(r)}}:t!==j?{type:ae,value:ce,meta:{error:"n supplied to COMPLEX must be a number but found "+String(n)+" ("+String(t)+")"}}:u!==j?{type:ae,value:ce,meta:{error:"i supplied to COMPLEX must be a number but found "+String(a)+" ("+String(u)+")"}}:0===a?{type:j,value:e,meta:{type:$,r:e,i:a,suffix:r}}:0===e?{type:q,value:a+r,meta:{type:$,r:e,i:a,suffix:r}}:{type:q,value:e+"+"+a+r,meta:{type:$,r:e,i:a,suffix:r}},CONCAT:e=>{const t=e.reduce((e,{value:t,type:a})=>a===q?e+t:a===W?e+t.map(e=>e.value).join(""):a===K?t.reduce((e,t)=>e+t.map(e=>e.value).join(""),e):e+t,"");return{type:q,rv:t}},CONFIDENCE:([{value:e},{value:t},{value:a}])=>({type:j,value:jstat.normalci(0,e,t,a).pop()}),"CONFIDENCE.NORM":(e,t)=>t.functions.CONFIDENCE(e,t),"CONFIDENCE.T":([{value:e}])=>({type:j,value:jstat.tci(0,a,sd,n).pop()}),CONVERT:([{value:e},{value:t},{value:a}])=>{const u=u=>{const[[r,n,l],[o,s,v]]=[t,a].map(e=>{let t="";return[Object.keys(u).find(a=>{if(e===a)return!0;const u=(r=a,n=e,Object.keys(He).find(e=>e+r===n));var r,n;return!!u&&(t=u,!0)}),He[t]||1,t||""]});return console.log("xfrom, yfrom",r,o),r&&o?[u[r]/u[o]*n/s*e,n,s,l,v]:[!1]};let r=null;const[n]=Object.entries({Speed:ke,Information:Ye,Area:Xe,Volume:Ge,Temperature:Be,Magnetism:Ve,Power:Fe,Energy:Pe,Force:xe,Pressure:Ue,Time:_e,Distance:De,"Weight and mass":Le}).find(([e,t])=>{const a=u(t);console.log("r",a);const[n]=a;return!!n&&(r=a,!0)})||[];return null!==r?{type:j,value:r[0],meta:{cat:n,multiplicatorFrom:r[1],multiplicatorTo:r[2],fromUnit:r[3],toUnit:r[4]}}:{type:ae,value:"No match found for types '"+t+"' - '"+a+"'"}},CORREL:([{value:e,type:t},{value:a,type:u}],r)=>{if(t!==W||u!==W)return{type:ae,value:"Both arguments of CORREL must be LIST, but found "+t+"/"+u};const[n,l]=[e,a].map(e=>e.filter(({type:e})=>e==j));if(n.length!==l.length)return{type:ae,value:ve,meta:{error:"Expected in CORREL(x,y) that x.length===y.length, but found "+n.length+"!=="+l.length}};const{value:o}=r.functions.AVERAGE([{type:W,value:n}]),{value:s}=r.functions.AVERAGE([{type:W,value:l}]),v=n.map(({value:e})=>e-o),c=l.map(({value:e})=>e-s),i=v.map((e,t)=>e*c[t]),p=v.map(e=>e*e),f=c.map(e=>e*e),y=i.reduce((e,t)=>e+t,0),h=p.reduce((e,t)=>e+t,0),E=f.reduce((e,t)=>e+t,0);return 0===h||0===E?{type:ae,value:fe,meta:{error:"Expected CORREL's s to be != 0, but found "+h+"/"+E}}:{type:j,value:y/Math.sqrt(h*E)}},COS:([{value:e}])=>({type:j,value:Math.cos(e)}),COSH:([{value:e}])=>({type:j,value:Math.cosh(e)}),COT:([{value:e}])=>({type:j,value:1/Math.tan(e)}),COTH:([{value:e}])=>({type:j,value:1/Math.tanh(e)}),COUPDAYBS:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),COUPDAYS:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),COUPDAYSNC:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),COUPNCD:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),COUPNUM:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),COUPPCD:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),_COVAR:([{value:e,type:t},{value:a,type:u}],r,n)=>{if(t!==W||u!==W)return{type:ae,value:"Both arguments of CORREL must be LIST, but found "+t+"/"+u};const[l,o]=[e,a].map(e=>e.filter(({type:e})=>e==j));if(l.length!==o.length)return{type:ae,value:ve,meta:{error:"Expected in COVAR(x,y) that x.length===y.length, but found "+l.length+"!=="+o.length}};if(0===l.length||0===o.length)return{type:ae,value:fe,meta:{error:"Expected COVAR's x and y to be != 0, but found "+l.length+"/"+o.length}};const{value:s}=r.functions.AVERAGE([{type:W,value:l}]),{value:v}=r.functions.AVERAGE([{type:W,value:o}]),c=l.map(({value:e})=>e-s),i=o.map(({value:e})=>e-v),p=c.map((e,t)=>e*i[t]).reduce((e,t)=>e+t,0);return{type:j,value:p/(l.length+n)}},COVAR:(e,t)=>t.functions._COVAR(e,t,0),"COVARIANCE.P":(e,t)=>t.functions._COVAR(e,t,0),"COVARIANCE.S":(e,t)=>t.functions._COVAR(e,t,-1),CRITBINOM:(e,t)=>t.functinos["BINOM.INV"](e,t),CSC:([{value:e}])=>({type:j,value:1/Math.sin(e)}),CSCH:([{value:e}])=>({type:j,value:1/Math.sinh(e)}),CUBEKPIMEMBER:([{value:e}])=>({type:ee,value:e}),CUBEMEMBER:([{value:e}])=>({type:ee,value:e}),CUBEMEMBERPROPERTY:([{value:e}])=>({type:ee,value:e}),CUBERANKEDMEMBER:([{value:e}])=>({type:ee,value:e}),CUBESET:([{value:e}])=>({type:ee,value:e}),CUBESETCOUNT:([{value:e}])=>({type:ee,value:e}),CUBEVALUE:([{value:e}])=>({type:ee,value:e}),CUMIPMT:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),CUMPRINC:([{value:e}])=>({type:ee,value:"todo: from finacial function"}),_DATABASE:([{value:e},{value:t}],a)=>{const[u,...r]=e,n=u.map(({value:e})=>e),l=r.map(e=>e.reduce((e,{value:t,type:a},u)=>({...e,[n[u]]:{value:t,type:a}}),{})),[o,...s]=t,v=o.map(({value:e})=>e),c=s.map(e=>e.reduce((e,{value:t,type:a},u)=>({...e,[u]:{value:t,type:a,key:v[u]}}),{}));return{type:W,value:l.filter(e=>c.some(t=>Object.entries(t).every(([t,u])=>((e,t)=>a.functions._CRITMATCHER([t],a)({value:e}))(e[u.key].value,u)))),meta:{criteria:c.map(e=>Object.values(e).map(({key:e,value:t})=>({field:e,matches:t})))}}},DAVERAGE:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n}=r.functions._DATABASE([{value:e},{value:u}],r),[l]=e,o=l.map(({value:e})=>e),s=a===j?o[t-1]:t;if(0===n.length)return{type:ae,value:fe,meta:{error:"No entires matched the search"}};const v=r.functions.AVERAGE(n.map(e=>e[s]));return{type:j,value:v,meta:{matches:n}}},DAYS:([{value:e,type:t},{value:a,type:u}])=>{const r=t===ue?e:new Date(e),n=u===ue?a:new Date(a);return{type:j,value:(n.getTime()-r.getTime())/864e5}},DAYS360:([{value:e,type:t},{value:a,type:u},{value:r}={value:!1}])=>{let n=e.getDate(),l=a.getDate(),o=e.getMonth(),s=a.getMonth();const v=new Date(2008,o+1,0).getDate(),c=new Date(2008,s+1,0).getDate();if(!1===r)n===v&&(n=30),l===c&&n<30?(l=1,s+=1):l===c&&(l=30);else{if(!0!==r)return{type:ae,value:"DAYS360's method must be either true or false, but found "+r};31===l&&(l=30),31===n&&(n=30)}return{type:j,value:30*(s-o)+l-n,meta:{d1d:n,d2d:l,d1m:o,d2m:s}}},DB:([{value:e},{value:t},{value:a},{value:u},{value:r}={value:12}],n)=>{const l=1-(t/e)**(1/a),o=Math.round(1e3*l)/1e3;if(1===u)return{type:j,value:e*o*r/12};if(u===a){const{value:l}=n.functions.DB([{value:e},{value:t},{value:a},{value:u-1},{value:r}],n);return{type:j,value:(e-l)*o*(12-r)/12}}const{value:s}=n.functions.DB([{value:e},{value:t},{value:a},{value:u-1},{value:r}],n);return{type:j,value:(e-s)*o}},DBCS:([{value:e}])=>({type:q,value:e.split("").map(e=>e.charCodeAt(0)<65248?String.fromCharCode(e.charCodeAt(0)+65248):e).join("")}),DCOUNT:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions.COUNT(n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DCOUNTA:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions.COUNTA(n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DDB:([{value:e},{value:t},{value:a},{value:u},{value:r}={value:2}],n)=>{if(u<=0)return{type:j,value:0};const{value:l}=n.functions.DDB([{value:e},{value:t},{value:a},{value:u-1},{value:r}],n);return{type:j,value:Math.min(r/a*(e-l),e-t-l)}},_DEC2X:([{value:e,type:t},a,{value:u}={value:!0}],r,n)=>{const l=r.functions.BASE([{value:u&&e<0?n**10+e:e,type:t},{type:j,value:n},a],r);return a&&a.value>0&&l.value.length>a.value?{type:ae,value:pe,meta:{result:l}}:l},DEC2BIN:(e,t)=>t.functions._DEC2X(e,t,2),DEC2HEX:(e,t)=>t.functions._DEC2X(e,t,16),DEC2OCT:(e,t)=>t.functions._DEC2X(e,t,8),DECIMAL:([{value:e},{value:t}])=>({type:j,value:parseInt(e,t)}),DEGREES:([{value:e}])=>({type:j,value:e*(180/Math.PI)}),DELTA:([{value:e,type:t},{value:a,type:u}={value:0,type:j,meta:{error:"Expected DELTA n1 and n2 to be both of type NUMBER, but found "+String(t)+"/"+String(u)}}])=>t!==j||u!==j?{type:ae,value:ce}:{type:j,value:+(e===a)},DEVSQ:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),u=e.reduce((e,{value:u,type:r})=>{switch(r){case ee:case q:return e;case j:return e+(u-a)*(u-a);case W:return e+t.functions.DEVSQ(u,t).value;default:throw new Error("Disallowed value "+String(u)+" of type "+String(r)+" found in AVERAGE")}},0);return{type:j,value:u,meta:{avg:a}}},DGET:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t;return n.length?n.length>1?{type:ae,value:pe}:{...n[0][v],meta:{...l,matches:n}}:{type:ae,value:ce}},DISC:([{value:e}])=>({type:ee,value:e}),DMAX:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t;return n.length?{...r.functions.MAX(n.map(e=>e[v]),r),meta:{...l,matches:n}}:{type:ae,value:ce}},DMIN:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t;return n.length?{...r.functions.MIN(n.map(e=>e[v]),r),meta:{...l,matches:n}}:{type:ae,value:ce}},DOLLAR:([{value:e,type:t},a={value:2,type:j}],u)=>{const{value:r}=u.functions.ROUND([{value:e,type:t},a],u),n="$"+r;return r<0?{type:q,value:"("+n+")"}:{type:q,value:n}},DOLLARDE:([{value:e},{value:t}])=>{const[a,u]=e.toFixed(2).split("."),r=parseInt(u)/t;return{type:j,value:parseInt(a)+r,meta:{intp:a,fracp:u}}},DOLLARFR:([{value:e},{value:t}])=>{const[a]=e.toFixed(0).split("."),u=(e-a)*t/100;return{type:j,value:parseInt(a)+u,meta:{intp:a,fracp:e-a}}},DPRODUCT:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions.PRODUCT(n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DSTDEV:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions["STDEV.S"](n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DSTDEVP:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions["STDEV.P"](n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DSUM:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions.SUM(n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DURATION:([{value:e}])=>({type:ee,value:e}),DVAR:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions.VAR(n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},DVARP:([{value:e},{value:t,type:a},{value:u}],r)=>{const{value:n,meta:l}=r.functions._DATABASE([{value:e},{value:u}],r),[o]=e,s=o.map(({value:e})=>e),v=a===j?s[t-1]:t,{value:c}=r.functions.VARP(n.map(e=>e[v]),r);return{type:j,value:c,meta:{...l,matches:n}}},EFFECT:([{value:e,type:t},{value:a,type:u}])=>t!==j||u!==j?{type:ae,value:ce,meta:{error:"Espected EFFECT's arguments nominal_rate and npery to be NUMBER, but found "+String(t)+"/"+String(u)}}:e<=0?{type:ae,value:pe,meta:{error:"Expected EFFECT's nominal_rate to be <= 0, but found "+String(e)+" ("+String(t)+")"}}:a<1?{type:ae,value:pe,meta:{error:"Expected EFFECT's npery to be < 1, but found "+String(a)+" ("+String(u)+")"}}:{type:j,value:(1+e/a)**a-1},ENCODEURL:([{value:e}])=>({type:q,value:window.encodeURIComponent(e)}),ERF:([{value:e}])=>({type:j,value:"NOT IMPLEMETNED"}),"ERF.PRECISE":([{value:e}])=>({type:j,value:"NOT IMPLEMETNED"}),ERFC:([{value:e}])=>({type:j,value:"NOT IMPLEMETNED"}),"ERFC.PRECISE":([{value:e}])=>({type:j,value:"NOT IMPLEMETNED"}),"ERROR.TYPE":([{value:e,type:t}])=>{const a={NULLE:1,DIV0:2,VVALUE:3,REFVALUE:4,NAMEE:5,NUMVALUE:6,NAVALUE:7,GETTINGDATA:8}[e]||ve;return{type:t!==ae||a===ve?ae:j,value:a}},EUROCONVERT:([{value:e}])=>({type:ee,value:e}),EXP:([{value:e}])=>({type:j,value:Math.E**e}),"EXPON.DIST":([{value:e},{value:t},{value:a}])=>({type:j,value:"NOT implemented"}),EXPONDIST:(e,t)=>t.functions["EXPON.DIST"](e,t),_FACT:(e,t=1,a=1,u)=>e<=1?t:u.functions._FACT(e-a,t*e,a,u),FACT:([{value:e}],t)=>e<0?{type:ae,value:pe}:{type:j,value:t.functions._FACT(e,1,1,t)},FACTDOUBLE:([{value:e}],t)=>e<0?{type:ae,value:pe}:{type:j,value:t.functions._FACT(e,1,2,t)},FACTN:([{value:e},{value:t}={value:1}],a)=>e<0?{type:ae,value:pe}:{type:j,value:a.functions._FACT(e,1,t,a)},FALSE:()=>({type:Z,value:!1}),"F.DIST":([{value:e}])=>{},FDIST:([{value:e}])=>({type:ee,value:e}),"F.DIST.RT":([{value:e}])=>({type:ee,value:e}),FILTER:([{value:e,type:t},{value:a,type:u},r={type:ae}])=>{let n=e;if(t===W&&(n=[n]),t!==K&&t!==W)return{type:ae,value:"FILTER expects a LIST or MATRIX as the first argument, but found "+String(t)};if(u!==W)return{type:ae,value:"FILTER expects a LIST as the second argument, but found "+String(u)};const l=n.filter((e,t)=>a[t].value);return l.length?{type:J,value:l}:{...r}},FILTERXML:([{value:e},{value:t}])=>{const a=(new DOMParser).parseFromString(e,"application/xml"),u=new XPathEvaluator,r=(r,n,l)=>{try{const o=u.createExpression(t).evaluate(a,r);return console.log(o,t,a,e),{type:l,value:o[n]}}catch(e){return{type:ae,result:ce,meta:{error:e}}}},n=r(XPathResult.STRING_TYPE,"stringValue",q);if(n.type!==ae)return n;const l=r(XPathResult.NUMBER_TYPE,"numberValue",j);if(l.type!==ae)return l;const o=r(XPathResult.BOOLEAN_TYPE,"booleanValue",Z);return o.type!==ae?o:{type:ae,result:ce,meta:{x:n,y:l,z:o}}},FIND:([{value:e},{value:t},{value:a}={}])=>({type:j,value:t.indexOf(e,a)+1}),FINDB:([{value:e},{value:t},{value:a}={}])=>{const u=t.indexOf(e,a),r=(new TextEncoder).encode(t.substring(0,u)).length;return{type:j,value:r}},"F.INV":([{value:e},{value:t},{value:a}])=>({type:ae,value:"NOT IMPLEMENTED"}),"F.INV.RT":([{value:e},{value:t},{value:a}])=>({type:ae,value:"NOT IMPLEMENTED"}),FINV:(e,t)=>t.FUNCTIONS["F.INV"](e,t),FISHER:([{value:e}])=>({type:j,value:.5*Math.log((1+e)/(1-e))}),FISHERINV:([{value:e}])=>({type:j,value:(Math.E**(2*e)-1)/(Math.E**(2*e)+1)}),FIXED:([e,t={value:2},{value:a}={value:!1}],u)=>{const r=(new Intl.NumberFormat).resolvedOptions(),n=new Intl.NumberFormat(r.locale,{style:"decimal",useGrouping:!a}).format(u.functions.ROUNDDOWN([e,t],u).value);return{type:q,value:n}},"FLOOR.MATH":([{value:e},{value:t},{value:a}],u)=>1===a&&e<0?{type:j,value:t*Math.ceil(e/t)}:{type:j,value:t*Math.floor(e/t)},"FLOOR.PRECISE":([{value:e},{value:t}])=>({type:j,value:e&&t?t*Math.ceil(e/t):0}),FORECAST:(e,t)=>t.functions["FORECAST.LINEAR"](e,t),"FORECAST.ETS":([{value:e}])=>({type:ee,value:e}),"FORECAST.ETS.CONFINT":([{value:e}])=>({type:ee,value:e}),"FORECAST.ETS.SEASONALITY":([{value:e}])=>({type:ee,value:e}),"FORECAST.ETS.STAT":([{value:e}])=>({type:ee,value:e}),"FORECAST.LINEAR":([{value:e,type:t},{type:a,value:u},{type:r,value:n}])=>{if(a!==W||r!==W)return{type:ae,value:"Expected x and y of FORECAST.LINEAR to be LIST, but found "+a+"/"+r};if(t!==j)return{type:ae,value:"Expected FORECAST.LINEAR's first param to be NUMBER, found "+e+"("+t+")"};const l=u.map(({value:e})=>e),o=n.map(({value:e})=>e),s=e=>{const[t,a]=e.reduce(([e,t],a)=>[e+a,t+1],[0,0]);return t/a},v=s(l),c=s(o),[i,p]=l.reduce(([e,t],a,u)=>[e+(a-v)*(o[u]-c),t+(a-v)*(l[u]-v)],[0,0]),f=i/p,y=c-f*v;return{type:j,value:y+f*e,meta:{m:f,b:y}}},FORMULATEXT:([{type:e,meta:{type:t},formula:a,value:u}])=>{if(t===G)return{type:a?q:ae,value:a||ve};if(e===W&&u[0].meta.type===G){const{formula:e}=u[0];return{type:e?q:ae,value:e||ve}}if(e===K&&u[0][0].meta.type===G){const{formula:e}=u[0][0];return{type:e?q:ae,value:e||ve}}return{type:ae,value:ce}},FREQUENCY:([{type:e,value:t},{type:a,value:u}])=>{if(e!==W||a!==W)return{type:ae,value:"Expected both arguments of FREQUENCY to be LIST but found "+e+"/"+a};if(0===u.length)return{type:j,value:t.length};const r=u.sort().reverse(),[n,l]=t.filter(({type:e})=>e!==ee).reduce(([e,t],{value:a},u)=>{const n=r.findIndex(({value:e})=>a>e),l=-1===n?0:r.length-n;return e[l]+=1,t[l]=[...t[l],a],[e,t]},[Array.from({length:u.length+1}).fill(0),Array.from({length:u.length+1}).fill([])]);return{type:J,value:n.map(e=>({value:e,type:j})),meta:{results:n,cats:l}}},"F.TEST":(e,t)=>t.functions.FTEST(e,t),FTEST:([{value:e},{value:t}])=>({type:ae,value:"NOT IMPLEMENTED"}),FVSCHEDULE:([{value:e},{value:t,type:a}])=>a!==W?{type:ae,value:ce,meta:{error:"Expected FVSCHEDULE's schedule to be of type LIST, found "+a}}:{type:t.some(({type:e})=>e!==j&&e!==ee)?ae:j,value:t.reduce((e,{value:t,type:a})=>a!==j&&a!==ee?ce:e*(1+(t||0)),e)},GAMMA:([{value:e}])=>({type:ee,value:e}),"GAMMA.DIST":([{value:e}])=>({type:ee,value:e}),GAMMADIST:([{value:e}])=>({type:ee,value:e}),"GAMMA.INV":([{value:e}])=>({type:ee,value:e}),GAMMAINV:([{value:e}])=>({type:ee,value:e}),GAMMALN:([{value:e}])=>({type:ee,value:e}),"GAMMALN.PRECISE":([{value:e}])=>({type:ee,value:e}),GAUSS:([{value:e}])=>({type:ee,value:e}),_GCD2:([{value:e},{value:t},...a])=>{let u=Math.abs(e),r=Math.abs(t);for(;r;){var n=r;r=u%r,u=n}return{type:j,value:u}},GCD:(e,t)=>e.reduce((e,a)=>t.functions._GCD2([e,a],t)),GEOMEAN:(e,t)=>{const[a,u]=e.reduce(([e,a],{value:u,type:r})=>{switch(r){case ee:return[e,a];case j:return[e*u,a+1];case W:const{meta:{count:n,prod:l}}=t.functions.GEOMEAN(u,t);return[e*l,a+n];default:throw new Error("Disallowed value "+String(u)+" of type "+String(r)+" found in GEOMEAN")}},[1,0]);return{type:j,value:Math.pow(a,1/u),meta:{prod:a,count:u}}},GESTEP:([{value:e},{value:t}={value:0}])=>({type:j,value:+(e>t)}),GETPIVOTDATA:([{value:e}])=>({type:ee,value:e}),GROWTH:([{value:e}])=>({type:ee,value:e}),HARMEAN:(e,t)=>{const[a,u]=e.reduce(([e,a],{value:u,type:r})=>{switch(r){case ee:return[e,a];case j:return[e+1/u,a+1];case W:const{meta:{count:n,sum:l}}=t.functions.HARMEAN(u,t);return[e+l,a+n];default:throw new Error("Disallowed value "+String(u)+" of type "+String(r)+" found in HARMEAN")}},[0,0]);return{type:j,value:u/a,meta:{sum:a,count:u}}},HEX2BIN:([{value:e},{value:t}={value:0}])=>({type:q,value:parseInt(e,16).toString(2).padStart(t,"0")}),HEX2DEC:([{value:e}])=>({type:j,value:parseInt(e,16)}),HEX2OCT:([{value:e},{value:t}={value:0}])=>({type:q,value:parseInt(e,16).toString(8).padStart(t,"0")}),HLOOKUP:([e,t,a,u={type:Z,value:!0}],r)=>{if(t.type===W&&(t={type:K,value:[t.value]}),t.type!==K)throw new Error("Expected table_array to be a MATRIX but found "+t.value+" ("+t.type+")");const n=t.value.findIndex(([t])=>e.value==t.value||e.type===q&&t.type===q&&e.value.toLowerCase()===t.value.toLowerCase());if(n>-1)return t.value[n][a.value-1];if(!u.value)return{type:ae,value:ve};const l=[].concat(t.value.map(([e])=>e)),{_GREATER:o}=r.functions;let s={type:ae,value:ve};for(;l.length;){if(o(l[0].value,e.value))return s;const u=t.value[0][0].length-l.length;s=t.value[u][a.value-1],l.shift()}return s},"HYPGEOM.DIST":([{value:e}])=>({type:ee,value:e}),HYPGEOMDIST:([{value:e}])=>({type:ee,value:e}),IFS:(e,t)=>{for(let t=0;t<e.length;t+=2){const{value:a}=e[t];if(a)return{...e[t+1]}}return{type:ae,value:ve}},_PARSECOMPLEXSTRING:({value:e},t)=>{if("i"===e||"j"===e)return{i:1,r:0,suffix:e};if("-i"===e||"-j"===e)return{i:-1,r:0,suffix:e[e.length-1]};let[a,u]=e.split("+").map(e=>e.trim());if(a&&u&&(u.endsWith("j")||u.endsWith("i"))){return{i:"i"===u||"j"===u?1:parseFloat(u),r:parseFloat(a),suffix:u[u.length-1]}}if([a,u]=e.split("-").map(e=>e.trim()),a&&u&&(u.endsWith("j")||u.endsWith("i"))){return{i:"i"===u||"j"===u?-1:-1*parseFloat(u||"1"),r:parseFloat(a),suffix:u[u.length-1]}}if(e.endsWith("j")||e.endsWith("i"))return{i:parseFloat(e),r:0,suffix:e[e.length-1]};const r=parseFloat(e);return isNaN(r)?{type:ae,value:"_PARSECOMPLEX requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e)}:{i:0,r:r,suffix:"i"}},_PARSECOMPLEX:({value:e,type:t,meta:a},u)=>{if(t===j)return{i:0,r:e,suffix:"i"};const{type:r,r:n,i:l,suffix:o}=a||{};return r===$?{i:l,r:n,suffix:o}:u.functions._PARSECOMPLEXSTRING({value:e},u)},IMABS:([e],t)=>{const{r:a,i:u,type:r}=t.functions._PARSECOMPLEX(e,t);return r===ae?{type:ae,value:"IMABS requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)}:{type:j,value:Math.sqrt(a*a+u*u)}},IMAGINARY:([e],t)=>{const{i:a,type:u}=t.functions._PARSECOMPLEX(e,t);return u===ae?{type:ae,value:"IMAGINARY requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)}:{type:j,value:a}},IMARGUMENT:([e],t)=>{const{i:a,r:u,type:r}=t.functions._PARSECOMPLEX(e,t);return r===ae?{type:ae,value:"IMARGUMENT requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)}:{type:j,value:Math.atan(a/u)}},IMCONJUGATE:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMCONJUGATE requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=-1*a;return{type:q,value:u+"+"+l+n,meta:{type:$,r:u,i:l,suffix:n}}},IMCOS:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMCOS requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cos(u)*Math.cosh(-a),o=Math.sin(u)*Math.sinh(-a);return{type:q,value:l+"+"+o+n,meta:{type:$,r:l,i:o,suffix:n}}},IMCOSH:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMCOSH requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cosh(u)*Math.cos(a),o=Math.sinh(u)*Math.sin(a);return{type:q,value:l+"+"+o+n,meta:{type:$,r:l,i:o,suffix:n}}},IMCOT:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMCOT requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cosh(2*a)-Math.cos(2*u),o=Math.sin(2*u)/l,s=Math.sinh(2*a)/l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},IMCSC:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMCSC requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cos(2*u)-Math.cosh(2*a),o=-2*Math.cosh(a)*Math.sin(u)/l,s=2*Math.cos(u)*Math.sinh(a)/l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},IMCSCH:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMCSCH requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cos(2*a)-Math.cosh(2*u),o=-2*Math.sinh(u)*Math.cos(a)/l,s=2*Math.cosh(u)*Math.sin(a)/l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},IMDIV:([e,t],a)=>{const{i:u,r:r,type:n,suffix:l}=a.functions._PARSECOMPLEX(e,a),{i:o,r:s,type:v}=a.functions._PARSECOMPLEX(t,a);if(n===ae)return{type:ae,value:"IMDIV requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};if(v===ae)return{type:ae,value:"IMDIV requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(t.value)};const c=s*s+o*o,i=(r*s+u*o)/c,p=(u*s-r*o)/c;return{type:q,value:i+"+"+p+l,meta:{type:$,r:i,i:p,suffix:l}}},IMEXP:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMEXP requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.exp(u)*Math.cos(a),o=Math.exp(u)*Math.sin(a);return{type:q,value:l+"+"+o+n,meta:{type:$,r:l,i:o,suffix:n}}},IMLN:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMLN requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.log(Math.sqrt(u*u+a*a)),o=Math.atan(a/u);return{type:q,value:l+"+"+o+n,meta:{type:$,r:l,i:o,suffix:n}}},IMLOG10:(e,t)=>{const a=t.functions.IMLN(e,t);if(a.type===ae)return a;const{r:u,i:r,suffix:n}=a.meta,l=Math.log10(Math.E),o=u*l,s=r*l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},IMLOG2:(e,t)=>{const a=t.functions.IMLN(e,t);if(a.type===ae)return a;const{r:u,i:r,suffix:n}=a.meta,l=Math.log2(Math.E),o=u*l,s=r*l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},_IMPOWER2:([e,t],a)=>{const{i:u,r:r,type:n,suffix:l}=a.functions._PARSECOMPLEX(e,a),{i:o,r:s,type:v}=a.functions._PARSECOMPLEX(t,a);if(n===ae)return{type:ae,value:"IMPOWER requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};if(v===ae)return{type:ae,value:"IMPOWER requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(t.value)};const c=r*s-u*o,i=u*s+r*o;return{type:q,value:c+"+"+i+l,meta:{type:$,r:c,i:i,suffix:l}}},IMPOWER:([e,{value:t}],a)=>{const u=a.functions.IMLN([e],a);if(u.type===ae)return u;const{r:r,i:n,suffix:l}=u.meta;return a.functions.IMEXP([{type:q,value:r*t+"+"+n*t+l,meta:{type:$,r:r*t,i:n*t,suffix:l}}],a)},IMPRODUCT:(e,t)=>e.reduce((e,a)=>e.type===ae?e:t.functions._IMPOWER2([e,a],t)),IMREAL:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);return r===ae?{type:ae,value:"IMREAL requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)}:{type:j,value:u,meta:{type:$,r:u,i:0,suffix:n}}},IMSEC:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMSEC requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cos(2*u)+Math.cosh(2*a),o=2*Math.cos(u)*Math.cosh(a)/l,s=2*Math.sin(u)*Math.sinh(a)/l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},IMSECH:([e],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX(e,t);if(r===ae)return{type:ae,value:"IMSECH: requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};const l=Math.cos(2*a)+Math.cosh(2*u),o=2*Math.cos(a)*Math.cosh(u)/l,s=-2*Math.sin(a)*Math.sinh(u)/l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},IMSIN:([{value:e}],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX({value:e},t);if(r===ae)return{type:ae,value:"IMCOS requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e)};const l=Math.cos(u)*Math.cosh(-a),o=Math.cos(u)*Math.sinh(-a);return{type:q,value:l+"+"+o+n,meta:{type:$,r:l,i:o,suffix:n}}},IMSINH:([{value:e}],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX({value:e},t);if(r===ae)return{type:ae,value:"IMCOS requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e)};const l=Math.cos(a)*Math.sinh(u),o=Math.cosh(u)*Math.sin(a);return{type:q,value:l+"+"+o+n,meta:{type:$,r:l,i:o,suffix:n}}},IMSQRT:([e],t)=>t.functions.IMPOWER([e,{value:.5}],t),IMSUB:([e,t],a)=>{const{i:u,r:r,type:n,suffix:l}=a.functions._PARSECOMPLEX(e,a),{i:o,r:s,type:v}=a.functions._PARSECOMPLEX(t,a);if(n===ae)return{type:ae,value:"IMSUB requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};if(v===ae)return{type:ae,value:"IMSUB requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(t.value)};const c=r-s,i=u-o;return{type:q,value:c+"+"+i+l,meta:{type:$,r:c,i:i,suffix:l}}},_IMSUM2:([e,t],a)=>{const{i:u,r:r,type:n,suffix:l}=a.functions._PARSECOMPLEX(e,a),{i:o,r:s,type:v}=a.functions._PARSECOMPLEX(t,a);if(n===ae)return{type:ae,value:"IMSUM requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e.value)};if(v===ae)return{type:ae,value:"IMSUM requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(t.value)};const c=r+s,i=u+o;return{type:q,value:c+"+"+i+l,meta:{type:$,r:c,i:i,suffix:l}}},IMSUM:(e,t)=>e.reduce((e,a)=>t.functions._IMSUM2([e,a],t)),IMTAN:([{value:e}],t)=>{const{i:a,r:u,type:r,suffix:n}=t.functions._PARSECOMPLEX({value:e},t);if(r===ae)return{type:ae,value:"IMCOS requires the complex number to be entered in the format 'R+I[ij]' where R and I are numbers, found "+String(e)};const l=Math.cos(2*u)+Math.cosh(2*a),o=Math.sin(2*u)/l,s=Math.sinh(2*a)/l;return{type:q,value:o+"+"+s+n,meta:{type:$,r:o,i:s,suffix:n}}},INFO:([{value:e}])=>{switch(e){case"directory":return{type:q,value:window.location+""};case"numfile":return{type:q,value:"To be implemented todo"};case"origin":return{type:q,value:"$A: todo"};case"osversion":return{type:q,value:navigator.oscpu};case"recalc":return{type:q,value:"todo"};case"system":return{type:q,value:navigator.platform};default:return navigator[e]?{type:q,value:navigator[e]}:{type:ae,value:"INFO expected a valid kind, but found "+String(e)}}},INTERCEPT:([e,t],a)=>a.functions["FORECAST.LINEAR"]([{value:0,type:j},t,e],a),INTRATE:([{value:e}])=>({type:ee,value:e}),IPMT:([{value:e}])=>({type:ee,value:e}),IRR:([{value:e}])=>({type:ee,value:e}),ISBLANK:([{value:e,type:t}])=>({type:Z,value:t===ee&&!e}),ISERR:([{value:e,type:t}])=>({type:Z,value:t===ae&&e!==ve}),ISERROR:([{value:e,type:t}])=>({type:Z,value:t===ae}),ISEVEN:([{value:e,type:t}])=>t!==j?{type:ae,value:ce}:{type:Z,value:Math.floor(e)%2==0},ISFORMULA:([{formula:e}])=>({type:Z,value:e&&"="===e[0]}),ISLOGICAL:([{type:e}])=>({type:Z,value:e===Z}),ISNA:([{value:e}])=>({type:Z,value:e===ve}),ISNONTEXT:([{type:e}])=>({type:Z,value:e!==q}),ISNUMBER:([{type:e}])=>({type:NUBOOLEANLL,value:e===j}),ISODD:([{value:e,type:t}])=>t!==j?{type:ae,value:ce}:{type:Z,value:Math.floor(e)%2==1},ISREF:([{type:e,meta:t}])=>({type:Z,value:e!==ae&&t&&t.type===G}),ISTEXT:([{type:e}])=>({type:Z,value:e===q}),"ISO.CEILING":(e,t)=>t.functions.CEILING(e,t),ISOWEEKNUM:([e],t)=>t.functions.WEEKNUM([e,{value:21,type:j}],t),ISPMT:([{value:e},{value:t},{value:a},{value:u}])=>{const r=u/a,n=u-t*r;return{type:j,value:n*e,meta:{reduction_per_period:r,remaining_value:n}}},JIS:([{value:e}])=>({type:q,value:e.split("").map(e=>e.charCodeAt(0)<65248?String.fromCharCode(e.charCodeAt(0)+65248):e).join("")}),KURT:(e,t,a={})=>{const[u,r,n,l,o]=e.reduce((e,a)=>{if(e.type===ae)return e;if(a.type===ae)return a;const{value:u,type:r}=a;let[n,l,o,s,v]=e;if(r===W){const{meta:e,type:a,...c}=t.functions.KURT(u,t,{mean:n,M2:l,M3:o,M4:s,N:v});return a===ae?{meta:e,type:r,...c}:[e.mean,e.M2,e.M3,e.M4,e.N]}if(r===j){v+=1;const e=u-n,t=e/v,a=t*t,r=e*t*(v-1);return s+=r*a*(v*v-3*v+3)+6*a*l-4*t*o,o+=r*t*(v-2)-3*t*l,l+=r,n+=t,[n,l,o,s,v]}return[n,l,o,s,v]},[a.mean||0,a.M2||0,a.M3||0,a.M4||0,a.N||0]);return{type:j,value:(o-1)/((o-2)*(o-3))*((o+1)*(o*l/(r*r)-3)+6),meta:{mean:u,M2:r,M3:n,M4:l,N:o}}},_LCM2:([{value:e,type:t},{value:a,type:u}],r)=>t!==j||u!==j?{type:ae,value:ce,meta:{error:"Both parameters of _LCM2 need to be numeric, found "+String(t)+"/"+String(u)}}:e<0||a<0?{type:ae,value:pe,meta:{error:"Both parameters of _LCM2 need to be >0, found "+String(e)+"/"+String(a)}}:{type:j,value:e&&a?Math.abs(e*a/r.functions.GCD([{value:e},{value:a}],r).value):0},LCM:(e,t)=>e.reduce((e,a)=>t.functions._LCM2([e,a],t)),LEFT:([{value:e},{value:t}={value:1}])=>({type:q,value:e.substring(0,t)}),LEFTB:([{value:e},{value:t}={value:1}])=>{let a="",u=t-1;for(let t=0;0<=u;t++){u-=e.charCodeAt(t)<128?1:(r=e[t],unescape(encodeURIComponent(r))).length,a+=e[t]}var r;return{type:q,value:a}},LEN:([{value:e}])=>({type:j,value:e.length}),LENB:([{value:e}])=>({type:j,value:(new TextEncoder).encode(e).length}),LINEST:([{value:e}])=>({type:ee,value:e}),LN:([{value:e}])=>({type:j,value:Math.log(e)}),LOG:([{value:e},{value:t}={value:10}])=>({type:j,value:Math.log(e)/Math.log(t)}),LOG10:([{value:e}])=>({type:j,value:Math.log10(e)}),LOGEST:([{value:e}])=>({type:ee,value:e}),LOGINV:([{value:e}])=>({type:ee,value:e}),"LOGNORM.DIST":([{value:e}])=>({type:ee,value:e}),LOGNORMDIST:([{value:e}])=>({type:ee,value:e}),"LOGNORM.INV":([{value:e}])=>({type:ee,value:e}),LOOKUP:([{value:e,type:t},{value:a,type:u},{value:r}={}],n)=>{if(u===W){const u=a.findIndex(({value:a,type:u})=>e==a||t===q&&u===q&&e.toLowerCase()===a.toLowerCase());if(u)return r?r[u]:a[u];const l=[].concat(a),{_GREATER:o}=n.functions;let s={type:ae,value:ve};for(;l.length;){if(o(l[0].value,e))return s;s=(r||a)[a.length-l.length],l.shift()}return s}if(u===K){const r=a.length<a[0].length?n.functions.HLOOKUP:n.functions.VLOOKUP,l=a.length<a[0].length?a.length-1:a[0].length-1;return r([{value:e,type:t},{value:a,type:u},{value:l,type:j}],n)}return{type:ae,value:"Expected LOOKUP's lookup_vector to be LIST or MATRIX, but found "+String(u)}},MAXA:(e,t)=>{if(0===e.length)return{type:j,value:0};const a=e.reduce((e,{value:a,type:u})=>{switch(u){case q:case ee:case ae:return e;case ue:case Z:case j:return e<+a?+a:e;case W:const{value:r}=t.functions.MAXA(a,t);return e<r?r:e;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in MAXA")}},-1/0);return{type:j,value:a}},_MULTI_IFS:(e,t)=>{if(e.length<2)throw new Error("Excepted 'criteria_range1, criteria1', but found "+(e.length?"'criteria_range1'":"no arguments"));if(e.length%2)throw new Error("Wrong number of arguments, excepted 'criteria_range1, criteria1, [criteria_range2, criteria2]...', but found "+e.map((e,t)=>t%2?"criteria"+Math.ceil((t+1)/2):"criteria_range"+Math.ceil((t+1)/2)).join(", "));const[a,u]=e.reduce(([e,t],a,u)=>u%2?[e,[...t,a]]:[[...e,a],t],[[],[]]);if(!a.every((e,t,a)=>e.length===a[0].length))throw new Error("All defined ranges need to have the same length");const r=u.map(({value:e,type:a})=>t.functions._CRITMATCHER([{value:e,type:a}],t));return{type:W,value:a[0].value.map((e,t)=>a.every(({value:e},a)=>r[a](e[t])))}},MAXIFS:([{value:e},...t],a)=>{const{value:u}=a.functions._MULTI_IFS(t,a),r=e.filter((e,t)=>u[t]);return a.functions.MAX(r,a)},MDETERM:([{value:e,type:t}])=>{if(t!==K)return{type:ae,value:"MDETERM expectes its first argument to be a MATRIX, but found "+String(t)};const a=e.length;if(e.some(e=>e.length!==a))return{type:ae,value:ce,meta:{error:"MDETERM expectes its first argument to be a square MATRIX of size NxN, but found the matrix not to be squared"}};let u;if(e.some(e=>(u=e.find(({type:e})=>e!==j),u)))return{type:ae,value:ce,meta:{error:"MDETERM expectes all elements of the MATRIX to be of type NUMBER, but found "+String(u.value)+" ("+String(u.type)+")"}};const r=e=>2==e.length?e[0][0].value*e[1][1].value-e[0][1].value*e[1][0].value:e.reduce((t,a,u)=>t+Math.pow(-1,u)*e[0][u].value*r(n(e,u)),0),n=(e,t)=>{const a=e.map(e=>e.slice(0));return a.splice(0,1),a.forEach(e=>e.splice(t,1)),a};return{type:j,value:r(e)}},MDURATION:([{value:e}])=>({type:ee,value:e}),MEDIAN:(e,t,a=1,u=1)=>{const{value:r}=t.functions._CELL_COUNTA(e,t),n=e.reduce((e,a)=>{switch(a.type){case j:return[...e,a];case ee:case ue:case q:case ae:case Z:return e;case W:const{meta:{list:u}}=t.functions.MEDIAN(a.value,t);return e.concat(u);default:throw new Error("Disallowed value "+String(a.value)+" of type "+String(a.type)+" found in MEDIAN")}},[]),l=n.sort(({value:e},{value:t})=>e-t),o=r/2;return{...r%2?l[Math.floor(o)]:{...l[Math.floor(o)],value:(l[o].value*a+l[o-1].value*u)/2},meta:{list:n,even:!(r%2),odd:!!(r%2),middle:r%2?Math.floor(o):o+.5}}},MID:([{value:e},{value:t},{value:a}={value:1}])=>({type:q,value:e.substring(t-1,t+a-1)}),MIDB:([{value:e},{value:t},{value:a}={value:1}])=>{const u=e.substring(t-1);let r="",n=a-1;for(let e=0;0<=n;e++){n-=u.charCodeAt(e)<128?1:(l=u[e],unescape(encodeURIComponent(l))).length,r+=u[e]}var l;return{type:q,value:r}},MINIFS:([{value:e},...t],a)=>{const{value:u}=a.functions._MULTI_IFS(t,a),r=e.filter((e,t)=>u[t]);return a.functions.MIN(r,a)},MINA:(e,t)=>{if(0===e.length)return{type:j,value:0};const a=e.reduce((e,{value:a,type:u})=>{switch(u){case q:case ee:case ae:return e;case ue:case Z:case j:return e>+a?+a:e;case W:const{value:r}=t.functions.MINA(a,t);return e>r?r:e;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in MINA")}},1/0);return{type:j,value:a}},MINVERSE:([{value:e,type:t}])=>{if(t!==K)return{type:ae,value:ce,meta:{error:"MINVERSE must be called with one argument of type MATRIX, but found "+String(e)+" ("+String(t)+")"}};if(e.some(t=>t.length!==e.length))return{type:ae,value:ce,meta:{error:"MINVERSE must be called with a sqare MATRIX, but found non-sqare MATRIX"}};let a=0,u=0,r=0,n=e.length,l=0,o=[],s=[];for(a=0;a<n;a+=1)for(o[o.length]=[],s[s.length]=[],r=0;r<n;r+=1){if(o[a][r]=a===r?1:0,e[a][r].type!==j)return{type:ae,value:ce,meta:{error:"MINVERSE's value at "+String(a)+"/"+String(r)+" is expected to be of type NUMBER, but found "+String(e[a][r].value)+" ("+String(e[a][r].type)+")"}};s[a][r]=e[a][r].value}for(a=0;a<n;a+=1){if(l=s[a][a],0===l){for(u=a+1;u<n;u+=1)if(0!==s[u][a]){for(r=0;r<n;r++)l=s[a][r],s[a][r]=s[u][r],s[u][r]=l,l=o[a][r],o[a][r]=o[u][r],o[u][r]=l;break}if(l=s[a][a],0===l)return{type:ae,value:pe,meta:{error:"No inverse found!"}}}for(r=0;r<n;r++)s[a][r]=s[a][r]/l,o[a][r]=o[a][r]/l;for(u=0;u<n;u++)if(u!==a)for(l=s[u][a],r=0;r<n;r++)s[u][r]-=l*s[a][r],o[u][r]-=l*o[a][r]}const v=o.map(e=>e.map(e=>({type:j,value:e})));return{type:K,value:v}},MIRR:([{value:e}])=>({type:ee,value:e}),MMULT:([{value:e,type:t},{value:a,type:u}])=>{if(t!==K)return{type:ae,value:ce,meta:{error:"MMULT must be called with one argument of type MATRIX, but found "+String(e)+" ("+String(t)+")"}};if(u!==K)return{type:ae,value:ce,meta:{error:"MMULT must be called with one argument of type MATRIX, but found "+String(a)+" ("+String(u)+")"}};if(e.some(e=>e.length!==a.length)){const t=a[0].length+"x"+a.length,u=e[0].length+"x"+e.length;return{type:ae,value:ce,meta:{error:"MMULT must be called with two MATRIXs of NxK and KxM, but found "+String(t)+" and "+String(u)}}}const r=[],n=a.length;for(let t=0;t<e[0].length;t++){r[t]=[];for(let u=0;u<a.length;u++){let l=0;for(let r=0;r<n;r++){console.log(t,n,u,e,a,e[t][r],a[r][u]);const{value:o,type:s}=e[t][r];if(s!==j)return{type:ae,value:ce,meta:{error:"MATRIX b supplied to MMULT expected to contain only numeric arguments, but found "+String(o)+" ("+String(s)+") at "+String(t)+"/"+String(r)}};const{value:v,type:c}=a[r][u];if(c!==j)return{type:ae,value:ce,meta:{error:"MATRIX c supplied to MMULT expected to contain only numeric arguments, but found "+String(v)+" ("+String(c)+") at "+String(r)+"/"+String(u)}};l+=o*v}r[t][u]={type:j,value:l}}}return{type:K,value:r}},_MODE_INTERNAL_COUNT:Symbol("_MODE_INTERNAL_COUNT"),MODE:(e,t)=>{const a=t.functions._MODE_INTERNAL_COUNT,u=e.reduce((e,u)=>{const{type:r,value:n}=u;switch(r){case j:return{...e,[n]:[(e[n]?e[n][0]:0)+1,u]};case ee:case ue:case q:case ae:case Z:return e;case W:const{meta:l}=t.functions.MEDIAN(n,t),o=l[a],s=Object.assign({},e);return Object.keys(o).forEach(e=>{const[t,a]=o[e],u=s[e]&&s[e][0];s[e]=[(u||0)+t,a]}),s;default:throw new Error("Disallowed value "+String(n)+" of type "+String(r)+" found in MEDIAN")}},[]),r=Object.entries(u).sort(([e,[t]],[a,[u]])=>u-t),[[n,[l,o]]]=r,s=new Map(Object.values(u).map(([e,t])=>[t,e]));return{...o,meta:{[a]:u,counts:s,max:l}}},"MODE.MULT":(e,t)=>{const{meta:a}=t.functions.MODE(e,t),{counts:u,max:r}=a,n=Array.from(u).filter(([e,t])=>t===r).map(([e])=>e);return{type:J,value:n,meta:a}},"MODE.SNGL":(e,t)=>{const a=t.functions.MODE(e,t),{meta:{max:u}}=a;return u<2?{type:ae,value:ve,meta:{result:a,error:"MODE.SNGL expected duplicate values to exists, but found a max-count of "+String(u)}}:a},MULTINOMIAL:(e,t)=>{const[a,u]=e.reduce(([e,a],{value:u,type:r})=>{switch(r){case ee:case ae:case Z:case q:return[e,a];case j:case ue:return[e+u,a*t.functions._FACTORIAL([{value:u}],t)];case W:const{meta:{sum:n,product:l}}=t.functions.MULTINOMIAL(u,t);return[e+n,a*l];default:throw new Error("Disallowed value "+String(u)+" of type "+String(r)+" found in MULTINOMIAL")}},[0,1]),r=t.functions._FACTORIAL([{value:a}],t);return{type:j,value:r/u,meta:{sum:a,product:u}}},MUNIT:([{type:e,value:t}])=>{if(e!==j)return{type:ae,value:ce,meta:{error:"MUNIT expected its argument to be NUMBER, but found "+String(t)+" ("+String(e)+")"}};const a=Math.floor(t),u=[];for(let e=0;e<a;e++){u[e]=[];for(let t=0;t<a;t++)u[e][t]={type:j,value:+(t===e)}}return{type:K,value:u,meta:{dimension:a}}},N:([e])=>{const{type:t,value:a}=e;switch(t){case j:case ae:return e;case Z:return{type:j,value:+a};case ue:return{type:j,value:a.getTime()};default:return{type:j,value:0}}},NA:()=>({type:ae,value:ve}),"NEGBINOM.DIST":([{value:e}])=>({type:ee,value:e}),NEGBINOMDIST:([{value:e}])=>({type:ee,value:e}),NOMINAL:([{value:e},{value:t}])=>({type:j,value:((e+1)**(1/t)-1)*t}),"NORM.DIST":([{value:e}])=>({type:ee,value:e}),NORMDIST:([{value:e}])=>({type:ee,value:e}),NORMINV:([{value:e}])=>({type:ee,value:e}),"NORM.INV":([{value:e}])=>({type:ee,value:e}),"NORM.S.DIST":([{value:e}])=>({type:ee,value:e}),NORMSDIST:([{value:e}])=>({type:ee,value:e}),"NORM.S.INV":([{value:e}])=>({type:ee,value:e}),NORMSINV:([{value:e}])=>({type:ee,value:e}),NPER:([{value:e}])=>({type:ee,value:e}),NPV:([{value:e},...t],a,u=1)=>{const[r,n]=t.reduce(([t,u],{type:r,value:n})=>{switch(r){case j:return[t+n/(1+e)**u,u+1];case ee:case ue:case q:case ae:case Z:return[t,u];case W:const{meta:{sum:l,sidx:o}}=a.functions.NPV([{value:e},...n],a,u);return[t+l,o];default:throw new Error("Disallowed value "+String(n)+" of type "+String(r)+" found in MEDIAN")}},[0,u]);return{type:j,value:r,meta:{sum:r,sidx:n}}},NUMBERVALUE:([{value:e},{value:t}={},{value:a}={}])=>{const u=e.replace(/[ %\t\n\r]/g,"");if(""===u)return{type:j,value:0};const[r]=t||Intl.NumberFormat().formatToParts(1.1).find(e=>"decimal"===e.type).value,[n]=a||Intl.NumberFormat().formatToParts(1e7).find(e=>"group"===e.type).value,[l]=e.match(/(%)*$/),[o,s="",v]=u.split(r);if(v)return{type:ae,value:ce,meta:{error:"decimal seperator used more than once in NUMBERVALUE's text-argument; only one usage of "+String(r)+" is allowed"}};if(s.indexOf(n)>-1)return{type:ae,value:ce,meta:{error:"group seperator must not be used in NUMBERVALUE's text-argument's *decimal*-part; usage of "+String(n)+" is only allowed in its integer part"}};const c=o.split(n).join(""),i=/[^0-9+-]/;if(i.test(c)||i.test(s)){const e=c.match(i)||s.match(i);return{type:ae,value:ce,meta:{error:"NUMBERVALUE's text-argument must not include any other signs but 0-9, +, -, "+String(r)+", "+String(n)+", % and ' ' (space), but found "+String(e[0])}}}const p=parseFloat(c+"."+s)/Math.pow(100,l.length);return{type:j,value:p,meta:{percents:l.length,decimal:r,group:n}}},OCT2BIN:([{value:e},{value:t}={value:0}])=>({type:q,value:parseInt(e,8).toString(2).padStart(t,"0")}),OCT2DEC:([{value:e},{value:t}={value:0}])=>({type:j,value:parseInt(e,8)}),OCT2HEX:([{value:e},{value:t}={value:0}])=>({type:q,value:parseInt(e,8).toString(16).padStart(t,"0")}),ODDFPRICE:([{value:e}])=>({type:ee,value:e}),ODDFYIELD:([{value:e}])=>({type:ee,value:e}),ODDLPRICE:([{value:e}])=>({type:ee,value:e}),ODDLYIELD:([{value:e}])=>({type:ee,value:e}),PDURATION:([{value:e},{value:t},{value:a}])=>{const u=(Math.log(a)-Math.log(t))/Math.log(1+e);return{type:j,value:u}},PEARSON:([{value:e,type:t},{value:a,type:u}],r)=>{if(t!==W||u!==W)return{type:ae,value:"PEARSON's arguments must be LISTs, but found "+String(e)+" ("+String(t)+") / "+String(a)+" ("+String(u)+")"};if(e.length!==a.length)return{type:ae,value:"PEARSON's arguments must have the same length"};const{value:n}=r.functions.AVERAGE(e,r),{value:l}=r.functions.AVERAGE(a,r),[o,s,v]=e.reduce(([e,t,u],{value:r},o)=>{const{value:s}=a[o];return[e+(r-n)*(s-l),t+(r-n)*(r-n),u+(s-l)*(s-l)]},[0,0,0]);return{value:o/Math.sqrt(s*v),type:j}},"PERCENTILE.EXC":([{value:e},{value:t}])=>{const a=e.sort(({value:e},{value:t})=>e-t),u=t*(e.length+1),r=Math.floor(u);if(r<=0||r>=e.length)return{type:ae,value:ve,meta:{error:"percentile out of range",idxx:r}};const n=u%1!=0?a[Math.ceil(u)-1].value:(a[u-1].value+a[u].value)/2;return{type:j,value:u,meta:{idxx:r,idx:u,sorted:a,percentile:n}}},"PERCENTILE.INC":([{value:e},{value:t}])=>{const a=e.sort(({value:e},{value:t})=>e-t),u=t*(e.length-1)+1,r=Math.floor(u);return r<=0||r>e.length?{type:ae,value:ve,meta:{error:"percentile out of range",idxx:r}}:{type:j,value:u,meta:{idxx:r,idx:u,sorted:a}}},PERCENTILE:(e,t)=>t.functions["PERCENTILE.INC"](e,t),"PERCENTRANK.EXC":([{value:e},{value:t},{value:a}={value:3}],u)=>{const r=e.sort(({value:e},{value:t})=>e-t);if(r.some(({value:e})=>e===t)){const e=r.filter(({value:e})=>e<=t).length,a=r.filter(({value:e})=>e>=t).length;return{type:j,value:e/(e+a),meta:{lt:e,gt:a,sorted:r}}}const n=r.findIndex(({value:e})=>e>t),l=(n+1)/(r.length+1),o=r[n].value,s=n/(r.length+1),v=r[n-1].value,c=(t-v)/(o-v),i=u.functions.ROUND([{value:a},{value:a}],u);return{type:j,value:i,meta:{P1:l,P2:s,V1:o,V2:v,P:c}}},"PERCENTRANK.INC":(e,t)=>t.functions.PERCENTRANK(e,t),PERCENTRANK:([{value:e},{value:t},{value:a}={value:3}],u)=>{const r=e.sort(({value:e},{value:t})=>e-t);if(r.some(({value:e})=>e===t)){const e=r.filter(({value:e})=>e<t).length,a=r.filter(({value:e})=>e>t).length;return{type:j,value:e/(e+a),meta:{lt:e,gt:a,sorted:r}}}const n=r.findIndex(({value:e})=>e>t),l=n/(r.length-1),o=r[n].value,s=(n-1)/(r.length-1),v=r[n-1].value,c=(t-v)/(o-v),i=u.functions.ROUND([{value:a},{value:a}],u);return{type:j,value:i,meta:{sorted:r,P1:l,P2:s,V1:o,V2:v,P:c}}},PERMUT:([{value:e},{value:t}],a)=>{const u=a.functions._FACTORIAL([{value:e}],a),r=a.functions._FACTORIAL([{value:e-t}],a);return{type:j,value:u/r}},PERMUTATIONA:([{value:e},{value:t}])=>({type:j,value:Math.pow(e,t)}),PHI:([{value:e}])=>({type:ee,value:e}),PHONETIC:([{value:e}])=>({type:ee,value:e}),PI:()=>({type:j,value:Math.PI}),PMT:([{value:e}])=>({type:ee,value:e}),"POISSON.DIST":([{value:e}])=>({type:ee,value:e}),POISSON:([{value:e}])=>({type:ee,value:e}),POWER:([{value:e},{value:t}])=>({type:j,value:Math.pow(e,t)}),PPMT:([{value:e}])=>({type:ee,value:e}),PRICE:([{value:e}])=>({type:ee,value:e}),PRICEDISC:([{value:e}])=>({type:ee,value:e}),PRICEMAT:([{value:e}])=>({type:ee,value:e}),PROB:([{value:e,type:t},{value:a,type:u},{value:r},{value:n}={}])=>{if(t!==W||u!==W)return{type:ae,value:"Expected PROB's first two arguments to be LISTs, but found "+String(t)+"/"+String(u)};const l=a.find(({value:e})=>e<=0||e>1);if(l)return{type:ae,value:pe,meta:{error:"PROB's probabilities must be >0 and <= 1, but found "+String(l.value)+" ("+String(l.type)+")"}};const o=a.reduce((e,{value:t})=>e+t,0);if(1!==o)return{type:ae,value:pe,meta:{error:"PROB's probabilities must add up to 1, but only add up to "+String(o)}};if(e.length!==a.length)return{type:ae,value:ve,meta:{error:"PROB's x-list and probabilities must have the same length, but found "+String(e.length)+"/"+String(a.length)}};if(null!=n){const t=e.map(({value:e},t)=>({value:e,p:a[t]})).filter(({value:e})=>e>=r&&e<=n),u=t.reduce((e,{p:{value:t}})=>e+t,0);return{type:j,value:u,meta:{valuesInRange:t,mode:"RANGE"}}}const s=e.findIndex(({value:e})=>e===r);return{...a[s],meta:{idx:s,mode:"MATCH"}}},PRODUCT:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case ee:case Z:return e;case j:case ue:return e*a;case W:const{value:r}=t.functions.PRODUCT(a,t);return e*r;case q:const n=parseFloat(a);return Number.isNaN(n)?e:e*n;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in SUM")}},0);return{type:j,value:a}},PV:([{value:e}])=>({type:ee,value:e}),QUARTILE:(e,t)=>t.functions["QUARTILE.INC"](e,t),"QUARTILE.EXC":([{value:e},{value:t}],a)=>{switch(t){case 0:return a.functions.MIN(e,a);case 2:return a.functions.MEDIAN(e,a);case 4:return a.functions.MAX(e,a);case 1:return a.functions.MEDIAN(e.slice(0,Math.floor(e.length/2)),a,1.5,.5);case 3:return a.functions.MEDIAN(e.slice(Math.ceil(e.length/2)),a,.5,1.5);default:return{type:ae,value:pe,meta:{error:"Invalid quartile "+String(t)+" in QUARTILE.EXC, must be <=0 and >=4"}}}},"QUARTILE.INC":([{value:e},{value:t}],a)=>{switch(t){case 0:return a.functions.MIN(e,a);case 2:return a.functions.MEDIAN(e,a);case 4:return a.functions.MAX(e,a);case 1:return a.functions.MEDIAN(e.slice(0,Math.ceil(e.length/2)),a,1.5,.5);case 3:return a.functions.MEDIAN(e.slice(Math.floor(e.length/2)),a,.5,1.5);default:return{type:ae,value:pe,meta:{error:"Invalid quartile "+String(t)+" in QUARTILE.INC, must be <=0 and >=4"}}}},QUOTIENT:([{value:e},{value:t}])=>({type:j,value:e<0?Math.ceil(e/t):Math.floor(e/t)}),RADIANS:([{value:e}])=>({type:j,value:e/180*Math.PI}),RANDARRAY:([{value:e}={value:1},{value:t}={value:1},a={value:0},u={value:1},{value:r}={value:!1}],n)=>{if(a.value>=u.value)return{type:ae,value:ce,meta:{error:"RANDARRAY's min must be >= max, but found min "+String(a.value)+" >= max "+String(u.value)}};const l=r?()=>n.functions.RANDBETWEEN([a,u],n):()=>({type:j,value:Math.random()*(u.value-a.value)+a.value});return 1===e&&1===t?l():1===e||1===t?{type:W,value:Array.from({length:Math.max(e,t)}).map(l),rowspan:e,colspan:t}:{type:K,value:Array.from({length:e}).map(()=>Array.from({length:t}).map(l)),rowspan:e,colspan:t}},_RANKG:([{value:e},{value:t},{value:a}={value:0}],u)=>{const r=t.sort(({value:e},{value:t})=>a?e-t:t-e).map((e,t,a)=>({...e,idx:t+1})).filter(({value:t})=>t===e).map(({idx:e})=>({value:e,type:j}));return{type:W,value:r}},"RANK.AVG":(e,t)=>{const{value:a}=t.functions._RANKG(e,t);return a.length?t.functions.AVERAGE(a,t):{type:ae,value:ve,meta:{error:"RANK.AVG search value was not found in ref"}}},"RANK.EQ":(e,t)=>{const{value:[a]}=t.functions._RANKG(e,t);return a||{type:ae,value:ve,meta:{error:"RANK.AVG search value was not found in ref"}}},RANK:(e,t)=>t.functions["RANK.EQ"](e,t),RATE:([{value:e}])=>({type:ee,value:e}),RECEIVED:([{value:e}])=>({type:ee,value:e}),"REGISTER.ID":([{value:e}])=>({type:ee,value:e}),REPLACE:([{value:e},{value:t},{value:a},{value:u}])=>{const r=e.substring(0,t-1)+u+e.substring(t+a-1);return{type:q,value:r}},REPLACEB:([e,t,a,{value:u}],r)=>{const{value:n}=r.functions.LEFTB([e,a],r),l=e.value.replace(n,u);return{type:q,value:l,meta:{search:n}}},REPT:([{value:e},{value:t}])=>({type:q,value:Array.from({length:t}).fill(e).join("")}),RIGHT:([{value:e},{value:t}={value:1}])=>({type:q,value:e.slice(-t)}),RIGHTB:([{value:e},{value:t}={value:1}])=>{let a="",u=t-1;for(let t=0;0<=u;t++){u-=e.charCodeAt(e.length-t-1)<128?1:(r=e[e.length-t-1],unescape(encodeURIComponent(r))).length,a=e[e.length-t-1]+a}var r;return{type:q,value:a}},ROMAN:([{value:e},{value:t}={value:0}])=>{const a=we,u=Object.entries(a.get(t)).sort(([e,t],[a,u])=>u-t);let r=0,n="";for(;e>0&&r<u.length;){const[t,a]=u[r];a<=e?(n+=t,e-=a):r++}return{type:q,value:n}},ROW:([{value:e,type:t,meta:a={}}={}],u)=>{if(!e)return{type:j,value:u.currentcell.row+1};if(a.type===G)return{type:j,value:a.row};throw new Error("ROW's first argumnet must be a cell-reference (meta.type=CELL)! Found "+String(e)+" ("+String(t)+"/"+String(a.type)+")")},ROWS:([{value:e,type:t}])=>{if(t===W){const{meta:{type:t,row:a}={}}=e[0],{meta:{type:u,row:r}={}}=e[e.length-1];return t===G&&u===G?{type:j,value:r-a+1}:{type:j,value:e.length}}if(t===K)return{type:j,value:e.length};throw new Error("ROWS must be called with LIST or MATRIX. Found "+String(e)+" ("+String(t)+")")},RRI:([{value:e},{value:t},{value:a}])=>({type:j,value:(a/t)**(1/e)-1}),RSQ:(e,t)=>{const a=t.functions.PEARSON(e,t),{value:u,type:r,...n}=a;return r===j?{...a,value:u*u}:a},RTD:([{value:e},{value:t},...a])=>({type:ee,value:"Not implemented"}),SEARCH:([{value:e},{value:t},{value:a}={value:0}],u)=>{const r=u.functions._TOSEARCHSTRING([e,!1,!1],u),n=t.substring(a).search(r);return{type:j,value:n+1+a,meta:{reg:r}}},SEARCHB:([{value:e},{value:t},{value:a}={}],u)=>{const r=u.functions._TOSEARCHSTRING([e,!1,!1],u),n=t.substring(a).search(r)+1,l=(new TextEncoder).encode(t.substring(0,n)).length;return{type:j,value:l}},SEC:([{value:e}])=>({type:j,value:1/Math.cos(e)}),SECH:([{value:e}])=>({type:j,value:1/Math.cosh(e)}),SEQUENCE:([{value:e},{value:t}={value:1},{value:a}={value:1},{value:u}={value:1}])=>{const r=e=>({type:j,value:a+e*u});return 1===e&&1===t?r(0):1===e||1===t?{type:W,value:Array.from({length:Math.max(e,t)}).map((e,t)=>r(t)),rowspan:e,colspan:t}:{type:K,value:Array.from({length:e}).map((e,a)=>Array.from({length:t}).map((e,t)=>r(t*a))),rowspan:e,colspan:t}},SERIESSUM:([{value:e},{value:t},{value:a},{value:u}],r)=>{const n=u.map(({value:u},r)=>u*e**(t+r*a)).reduce((e,t)=>e+t,0);return{type:j,value:n}},SHEET:()=>({type:j,value:-1,meta:{error:"Sheets are not numbered"}}),SHEETS:()=>({type:j,value:-1,meta:{error:"Sheets are not enumerable and can only be discovered"}}),SIGN:([{value:e}])=>({type:j,value:Math.sign(e)}),SIN:([{value:e}])=>({type:j,value:Math.sin(e)}),SINH:([{value:e}])=>({type:j,value:Math.sinh(e)}),_SKEW:(e,t,a,u)=>{const[r,n]=e.reduce(([e,r],{value:n,type:l})=>{switch(l){case ee:case Z:case q:case ae:return[e,r];case j:return[e+((n-a)/u)**3,r+1];case W:const{sum:o,count:s}=t.functions._SKEW(n,t,a,u).meta;return[e+o,r+s];default:throw new Error("Disallowed value "+String(n)+" of type "+String(l)+" found in _SKEW")}},[0,0]);return n<3?{type:ae,value:fe,meta:{sum:r,count:n}}:{type:j,value:n/(n-1)/(n-2)*r,meta:{sum:r,count:n}}},_SKEWP:(e,t,a,u)=>{const[r,n]=e.reduce(([e,r],{value:n,type:l})=>{switch(l){case ee:case Z:case q:case ae:return[e,r];case j:return[e+((n-a)/u)**3,r+1];case W:const{sum:o,count:s}=t.functions._SKEWP(n,t,a,u).meta;return[e+o,r+s];default:throw new Error("Disallowed value "+String(n)+" of type "+String(l)+" found in _SKEW")}},[0,0]);return{type:j,value:r/n,meta:{sum:r,count:n}}},SKEW:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEV(e,t,a).meta,n=Math.sqrt(u/(r-1));return t.functions._SKEW(e,t,a,n)},"SKEW.P":(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEV(e,t,a).meta,n=Math.sqrt(u/r);return t.functions._SKEWP(e,t,a,n)},SLN:([{value:e},{value:t},{value:a}])=>({type:j,value:(e-t)/a}),_SLOPE:([{value:e},{value:t}],a,u,r)=>{const[n,l]=t.reduce(([n,l],o,s)=>{const{value:v,type:c}=t[s],{value:i,type:p}=e[s];switch(c===p&&c){case ee:case Z:case q:case ae:return[sum,count];case j:return[n+(v-u)*(i-r),l+(v-u)*(v-u)];case W:const{s1:e,s2:t}=a.functions._SLOPE([v,i],a,u,r).meta;return[n+e,l+t];default:throw new Error("Disallowed value "+String(v)+" of type "+String(c)+" found in SLOPE")}},[0,0]);return{type:j,value:n/l,meta:{s1:n,s2:l}}},SLOPE:(e,t)=>{const[{value:a},{value:u}]=e,{value:r}=t.functions.AVERAGE(a,t),{value:n}=t.functions.AVERAGE(u,t);return t.functions._SLOPE(e,t,n,r)},SORT:([{value:e,type:t,...a},{value:u}={value:1},{value:r}={value:1},{value:n}={value:!1}],l)=>{if(t===W&&(e=[e]),!n){const n=e[u-1];if(u>e.length)return{type:ae,value:"Invalid sort_index encountered in SORT - the given MATRIX does not have such column"};const l=e.map(e=>e.map((e,t)=>({...e,meta:Object.assign(e.meta||{},{oidx:t})})).sort(({meta:{oidx:e}},{meta:{oidx:t}})=>r*(n[e].value-n[t].value)));return t===W?Object.assign(a,{type:t,value:l[0]}):Object.assign(a,{type:t,value:l})}if(e.some(e=>e.length<u))return{type:ae,value:"Invalid sort_index encountered in SORT - the given MATRIX does not have such column"};const o=e[0].map((t,a)=>e.map(e=>e[a])),s=o[u-1],v=o.map(e=>e.map((e,t)=>({...e,meta:Object.assign(e.meta||{},{oidx:t})})).sort(({meta:{oidx:e}},{meta:{oidx:t}})=>r*(s[e].value-s[t].value))),c=v[0].map((e,t)=>v.map(e=>e[t]));return t===W?Object.assign(a,{type:t,value:c.map(e=>e[0])}):Object.assign(a,{type:t,value:c})},SORTBY:([{value:e,type:t,...a},...u])=>{const r=u.map(({value:e})=>e).filter((e,t)=>!(t%2));if(t!==W)return{type:ae,value:"SORTBY expected a LIST, but found "+String(e)+" ("+String(t)+")"};if(r.length<1)return{type:ae,value:"SORTBY requires at least 1 criterium"};const n=e.map((e,t)=>({...e,meta:Object.assign(e.meta||{},{oidx:t})})).sort(({meta:{oidx:e}},{meta:{oidx:t}})=>{for(let a=0;a<r.length;a++){const n=r[a],l=(u[2*a+1]?u[a+1].value:1)*(n[e].value-n[t].value);if(l)return l}return 0});return Object.assign(a,{type:t,value:n})},SQRT:([{value:e}])=>e>=0?{type:j,value:Math.sqrt(e)}:{type:ae,value:pe},SQRTPI:([{value:e}])=>e>=0?{type:j,value:Math.sqrt(e*Math.PI)}:{type:ae,value:pe},STANDARDIZE:([{value:e},{value:t},{value:a}])=>a>=0?{type:j,value:(e-t)/a}:{type:ae,value:pe,meta:{error:"STANDARDIZE's Standard_dev must be >= 0"}},_STDEV:(e,t,a)=>{const[u,r]=e.reduce(([e,u],{value:r,type:n})=>{switch(n){case ee:case Z:case q:case ae:return[e,u];case j:return[e+(r-a)*(r-a),u+1];case W:const{result:l,ccount:o}=t.functions._STDEV(r,t,a).meta;return[e+l,u+o];default:throw new Error("Disallowed value "+String(r)+" of type "+String(n)+" found in AVERAGE")}},[0,0]);return{type:j,value:u/r,meta:{result:u,ccount:r}}},_STDEVA:(e,t,a)=>{const[u,r]=e.reduce(([e,u],{value:r,type:n})=>{switch(n){case ee:case ae:return[e,u];case Z:return[e+ +r,u+1];case q:const l=parseFloat(r);if(Number.isNaN(l))throw new Error("Disallowed value "+String(r)+" of type "+String(n)+" found in _STDEVA");return[e+l,u+1];case j:return[e+(r-a)*(r-a),u+1];case W:const{result:o,ccount:s}=t.functions._STDEVA(r,t,a).meta;return[e+o,u+s];default:throw new Error("Disallowed value "+String(r)+" of type "+String(n)+" found in _STDEVA")}},[0,0]);return{type:j,value:u/r,meta:{result:u,ccount:r}}},STDEV:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEV(e,t,a).meta;return{type:j,value:Math.sqrt(u/(r-1)),meta:{result:u,ccount:r}}},"STDEV.P":(e,t)=>t.functions.STDEVP(e,t),"STDEV.S":(e,t)=>t.functions.STDEV(e,t),STDEVA:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEVA(e,t,a).meta;return{type:j,value:Math.sqrt(u/(r-1)),meta:{result:u,ccount:r}}},STDEVP:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEV(e,t,a).meta;return{type:j,value:Math.sqrt(u/r),meta:{result:u,ccount:r}}},STDEVPA:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEVA(e,t,a).meta;return{type:j,value:Math.sqrt(u/r),meta:{result:u,ccount:r}}},_STEYX:([{value:e},{value:t}],a,u,r)=>{const[n,l,o,s]=t.reduce(([n,l,o,s],v,c)=>{const{value:i,type:p}=t[c],{value:f,type:y}=e[c];switch(p===y&&p){case ee:case Z:case q:case ae:return[n,l,o,s];case j:return[n+(i-u)*(f-r),l+(i-u)*(i-u),o+(f-r)*(f-r),s+1];case W:const{s1:e,s2:t,s3:v,count:c}=a.functions._STEYX([i,f],a,u,r).meta;return[n+e,l+t,o+v,s+c];default:throw new Error("Disallowed value "+String(i)+" of type "+String(p)+" found in _STEYX")}},[0,0,0,0]),v=Math.sqrt(1/(s-2)*(o-n*n/l));return{type:j,value:v,meta:{s1:n,s2:l,s3:o,count:s}}},STEYX:(e,t)=>{const[{value:a},{value:u}]=e,{value:r}=t.functions.AVERAGE(a,t),{value:n}=t.functions.AVERAGE(u,t);return t.functions._STEYX(e,t,n,r)},_FILTERTYPE:(e,t,...a)=>{const[{key:u,recurse:r=[W],ignore:n=[],error:l=[],allow:o=[],subelement:s=(({value:e})=>e),subelementreverse:v=((e,t)=>({...t,value:e}))},...c]=a,i=e.filter(e=>{const t=u(e);if(o.indexOf(t)>-1)return!0;if(n.indexOf(t)>-1)return!1;if(l.indexOf(t)>-1){new Error("Disallowed type "+String(t)+" found in _FILTERTYPE").object=e}return r.indexOf(t)>-1||0===o.length}).map(e=>{const n=u(e);return r.indexOf(n)>-1?v(t.functions._FILTERTYPE(s(e),t,...a),e):e});return c.length>0?t.functions._FILTERTYPE(i,t,...c):i},SUBTOTAL:([{value:e},...t],a)=>{const u=""+e,r={1:a.functions.AVERAGE,2:a.functions.COUNT,3:a.functions.COUNTA,4:a.functions.MAX,5:a.functions.MIN,6:a.functions.PRODUCT,7:a.functions.STDEV,8:a.functions.STDEVP,9:a.functions.SUM,10:a.functions.VAR,11:a.functions.VARP,101:a.functions.AVERAGE,102:a.functions.COUNT,103:a.functions.COUNTA,104:a.functions.MAX,105:a.functions.MIN,106:a.functions.PRODUCT,107:a.functions.STDEV,108:a.functions.STDEVP,109:a.functions.SUM,110:a.functions.VAR,111:a.functions.VARP};if(!r[u])return{type:ae,value:"UNexpected value for mode '"+String(u)+"' found in SUBTOTAL"};const n=[{key:({type:e})=>e,ignore:[ee]},{key:({meta:{type:e}={}})=>e,ignore:[H]}];u.startsWith("10")&&n.push({key:({meta:{visibility:e}={}})=>e,ignore:[de]});const l=a.functions._FILTERTYPE(t,a,...n),{meta:o={},...s}=r[u](l,a);return Object.assign(s,{meta:{...o,type:H}})},SUMIF:([{value:e,type:t},{value:a,type:u},{value:r}={}],n)=>{if(t!==W)throw new Error("SUMIF must be supplied a LIST, found value "+value+" of type "+t);const l=n.functions._CRITMATCHER([{value:a,type:u}],n),o=(r||e).filter((t,a)=>l(e[a])),{meta:s={},...v}=n.functions.SUM(o,n);return Object.assign(v,{meta:{...s,matches:o}})},SUMIFS:([{value:e},...t],a)=>{if(t.length<2)throw new Error("Excepted 'criteria_range1, criteria1', but found "+(t.length?"'criteria_range1'":"no arguments"));if(t.length%2)throw new Error("Wrong number of arguments, excepted 'criteria_range1, criteria1, [criteria_range2, criteria2]...', but found "+t.map((e,t)=>t%2?"criteria"+Math.ceil((t+1)/2):"criteria_range"+Math.ceil((t+1)/2)).join(", "));const[u,r]=t.reduce(([e,t],a,u)=>u%2?[e,[...t,a]]:[[...e,a],t],[[],[]]);if(u.some(({value:t})=>t.length!==e.length))throw new Error("All defined ranges must have the same length ("+u[0].value.length+") as it's sumrange ("+e.length+")");const n=r.map(({value:e,type:t})=>a.functions._CRITMATCHER([{value:e,type:t}],a)),l=e.filter((e,t)=>u.every(({value:e},a)=>n[a](e[t]))),{meta:o={},...s}=a.functions.SUM(l,a);return Object.assign(s,{meta:{...o,matches:l}})},SUMSQ:(e,t)=>{const a=e.reduce((e,{value:a,type:u})=>{switch(u){case ee:return e;case j:return e+a*a;case W:const{value:r}=t.functions.SUM(a,t);return e+r;default:throw new Error("Disallowed value "+String(a)+" of type "+String(u)+" found in SUM")}},0);return{type:j,value:a}},SUMX2MY2:([{value:e},{value:t}],a)=>{const u=e.reduce((u,r,n)=>{const{value:l,type:o}=e[n],{value:s,type:v}=t[n];switch(o===v&&o){case ee:case Z:case q:case ae:return u;case j:return u+(l*l-s*s);case W:const{value:e}=a.functions.SUMX2MY2([l,s],a);return u+e;default:throw new Error("Disallowed value "+l+" of type "+o+" found in SUMX2MY2")}},0);return{type:j,value:u}},SUMX2PY2:([{value:e},{value:t}],a)=>{const u=e.reduce((u,r,n)=>{const{value:l,type:o}=e[n],{value:s,type:v}=t[n];switch(o===v&&o){case ee:case Z:case q:case ae:return u;case j:return u+(l*l+s*s);case W:const{value:e}=a.functions.SUMX2PY2([l,s],a);return u+e;default:throw new Error("Disallowed value "+l+" of type "+o+" found in SUMX2PY2")}},0);return{type:j,value:u}},SUMXMY2:([{value:e},{value:t}],a)=>{const u=e.reduce((u,r,n)=>{const{value:l,type:o}=e[n],{value:s,type:v}=t[n];switch(o===v&&o){case ee:case Z:case q:case ae:return u;case j:return u+(l-s)*(l-s);case W:const{value:e}=a.functions.SUMX2PY2([l,s],a);return u+e;default:throw new Error("Disallowed value "+l+" of type "+o+" found in SUMX2PY2")}},0);return{type:j,value:u}},SWITCH:([{value:e},...t])=>{let a=void 0;t.length%2&&(a={...t.pop()});const[u,r]=t.reduce(([e,t],a,u)=>u%2?[e,[...t,a]]:[[...e,a],t],[[],[]]),n=u.findIndex(({value:t})=>e===t||e.valueOf()===t.valueOf());return r[n]?{...r[n]}:a||{type:ae,value:ve}},SYD:([{value:e},{value:t},{value:a},{value:u}])=>({type:j,value:(e-t)*(a-u+1)*2/(a*(a+1))}),T:([{value:e,type:t}])=>({type:q,value:t===q?e:""}),TAN:([{value:e}])=>({type:j,value:Math.tan(e)}),TANH:([{value:e}])=>({type:j,value:Math.tanh(e)}),TBILLEQ:([{value:e}])=>({type:ee,value:e}),TBILLPRICE:([{value:e}])=>({type:ee,value:e}),TBILLYIELD:([{value:e}])=>({type:ee,value:e}),"T.DIST":([{value:e}])=>({type:ee,value:e}),"T.DIST.2T":([{value:e}])=>({type:ee,value:e}),"T.DIST.RT":([{value:e}])=>({type:ee,value:e}),TDIST:([{value:e}])=>({type:ee,value:e}),TEXT:([{value:e},{value:t}])=>{},TEXTJOIN:([{value:e},{value:t},...a],u)=>{const r=a.reduce((a,{value:r,type:n})=>{if(t&&(""===r||null==r))return a;switch(n){case ee:case j:case q:case Z:return console.log("!",a,r),[...a,r];case W:console.log("!",a,r);const{list:l}=u.functions.TEXTJOIN([{value:e},{value:t},...r],u).meta;return[...a,...l];default:throw new Error("Disallowed value "+String(r)+" of type "+String(n)+" found in TEXTJOIN")}},[]);return{type:q,value:r.join(e),meta:{list:r}}},"T.INV":([{value:e}])=>({type:ee,value:e}),"T.INV.2T":([{value:e}])=>({type:ee,value:e}),TINV:([{value:e}])=>({type:ee,value:e}),TREND:([{value:e},{value:t},{value:a},{value:u}={value:!1}],r)=>{t||(t=e.map((e,t)=>({type:j,value:t+1}))),a||(a=t);const{value:n}=r.functions.AVERAGE(e,r),{value:l}=r.functions.AVERAGE(t,r),{value:o}=r.functions._SLOPE([{value:e},{value:t}],r,l,n),s=u?0:n-o*l,v=a.map(({value:e,...t})=>({...t,value:e*o+s}));return{type:a.type,value:v,meta:{m:o,b:s}}},TRIMMEAN:([{value:e},{value:t}],a)=>{const u=Math.round(e.length*t/2),r=e.sort(({value:e},{value:t})=>t-e).slice(u,-u);return console.log(e.length,t,e.length*t,u,r),a.functions.AVERAGE(r,a)},TRUE:()=>({type:Z,value:!0}),"T.TEST":([{value:e}])=>({type:ee,value:e}),TTEST:([{value:e}])=>({type:ee,value:e}),TYPE:([{type:e}])=>({type:j,value:{NUMBER:1,DATE:1,NULL:1,STRING:2,BOOLEAN:4,ERROR:16,LIST:64,MATRIX:64,ARGUMENTS:64}[e]}),UNICHAR:([{value:e}])=>({type:q,value:String.fromCharCode(e)}),UNICODE:([{value:e}])=>({type:j,value:e.charCodeAt(0)}),_FILTERUNIQUE:([e,t])=>{const a=new Map;let u=e.filter(e=>{let u=a,r=!0;for(const{value:t}of e)u.has(t)?u=u.get(t):(r=!1,map2=new Map,u.set(t,map2),u=map2);return t&&(u.has("line")?u.get("line").duplicate=!0:u.set("line",e)),!r});return t&&(u=u.filter(e=>!e.duplicate)),u},UNIQUE:([{value:e,type:t,...a},{value:u}={value:!1},{value:r}={value:!1}],n)=>{if(t===W&&(e=[e]),u){const u=n.functions._FILTERUNIQUE([e,r]);return t===W?Object.assign(a,{type:t,value:u[0]}):Object.assign(a,{type:t,value:u})}const l=e[0].map((t,a)=>e.map(e=>e[a])),o=n.functions._FILTERUNIQUE([l,r]),s=o[0].map((e,t)=>o.map(e=>e[t]));return t===W?Object.assign(a,{type:t,value:s[0]}):Object.assign(a,{type:t,value:s})},VAR:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEV(e,t,a).meta;return{type:j,value:u/(r-1),meta:{result:u,ccount:r}}},"VAR.P":(e,t)=>t.functions.VARP(e,t),"VAR.S":(e,t)=>t.functions.VAR(e,t),VARA:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEVA(e,t,a).meta;return{type:j,value:u/(r-1),meta:{result:u,ccount:r}}},VARP:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEV(e,t,a).meta;return{type:j,value:u/r,meta:{result:u,ccount:r}}},VARPA:(e,t)=>{const{value:a}=t.functions.AVERAGE(e,t),{result:u,ccount:r}=t.functions._STDEVA(e,t,a).meta;return{type:j,value:u/r,meta:{result:u,ccount:r}}},VDB:([{value:e}])=>({type:ee,value:e}),WEBSERVICE:([{value:e}])=>fetch(e).then(e=>e.text()).then(e=>({type:q,value:e})),WEIBULL:([{value:e}])=>({type:ee,value:e}),"WEIBULL.DIST":([{value:e}])=>({type:ee,value:e}),XIRR:([{value:e}])=>({type:ee,value:e}),XLOOKUP:([e,t,{value:a},u={type:ae,value:ve},r,n],l)=>{const o=l.functions.XMATCH([e,t,r,n],l),{value:s,type:v}=o;if(v===ae)return u;let c=a[s];return c&&0!==c.length?Array.isArray(c)?{value:c,type:W}:c:u},XMATCH:([{value:e},{value:t},{value:a}={value:0},{value:u}={value:1}],r)=>{const n={0:(e,t)=>(u>0?e:e.reverse()).findIndex(({value:e})=>e===t),"-1":(e,t)=>{const{_GREATER:a,_SMALLER:n}=r.functions;if(u>0){for(let u=0;u<e.length;u++){if(searchr[u].value===t)return u;if(a(searchr[u].value,t))return u-1}return-1}for(let a=e.length-1;a>=0;a--){if(searchr[a].value===t)return a;if(n(searchr[a].value,t))return a}return-1},1:(e,t)=>{const{_GREATER:a,_SMALLER:n}=r.functions;if(u>0){for(let u=0;u<e.length;u++){if(searchr[u].value===t)return u;if(a(searchr[u].value,t))return u}return-1}for(let a=e.length-1;a>=0;a--){if(searchr[a].value===t)return a;if(n(searchr[a].value,t))return a-1}return-1},2:(e,t)=>{const a=u>0?e:e.reverse(),n=r.functions._TOSEARCHSTRING([t],r);return a.findIndex(({value:e})=>n.test(e))}}[a+""](t,e);return n<0?{type:ae,value:ve}:{type:j,value:n}},XNPV:([{value:e}])=>({type:ee,value:e}),YIELD:([{value:e}])=>({type:ee,value:e}),YIELDDISC:([{value:e}])=>({type:ee,value:e}),YIELDMAT:([{value:e}])=>({type:ee,value:e}),"Z.TEST":([{value:e}])=>({type:ee,value:e}),ZTEST:([{value:e}])=>({type:ee,value:e}),JSON:([{value:e}])=>({type:Q,value:JSON.parse(e)}),JSONPATH:([{value:e,type:t},{value:a}])=>{t===q&&(e=JSON.parse(e));const u=a.replace(/\[([0-9]*)\]/g,".$1").split("."),r=u.reduce((e,t)=>e[t],e);return{type:Q,value:r,meta:{path:u,value:e}}}};var $e=function(){function e(t,a,u,r){this.message=t,this.expected=a,this.found=u,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(e,Error),e.buildMessage=function(e,t){var a={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t,a="";for(t=0;t<e.parts.length;t++)a+=e.parts[t]instanceof Array?n(e.parts[t][0])+"-"+n(e.parts[t][1]):n(e.parts[t]);return"["+(e.inverted?"^":"")+a+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function u(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+u(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+u(e)}))}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+u(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+u(e)}))}return"Expected "+function(e){var t,u,r,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=(r=e[t],a[r.type](r));if(n.sort(),n.length>0){for(t=1,u=1;t<n.length;t++)n[t-1]!==n[t]&&(n[u]=n[t],u++);n.length=u}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+r(e)+'"':"end of input"}(t)+" found."},{CELL:G,STR_ESCAPED:X,STR_PLAIN:Y,AGGREGATE:k,SUBTOTAL:H,NUMBER:j,COMPLEX_NUMBER:$,LIST:W,MATRIX:K,STRING:q,ANY:Q,BOOLEAN:Z,FUNCTION:z,ARGUMENTS:J,NULL:ee,ARRAY:te,ERROR:ae,DATE:ue,TIME:re,DATETIME:ne,TRACE:le,CELL_TRACE:oe,HYPERLINK:se,NAVALUE:ve,VVALUE:ce,REFVALUE:ie,NUMVALUE:pe,DIV0:fe,NULLE:ye,NAMEE:he,GETTINGDATA:Ee,INLINE:me,HIDDEN:de,NATURALREF:Ae,CIRCULAR:ge,SyntaxError:e,parse:function(t,a){a=void 0!==a?a:{};var u,r={},n={Start:nt},l=nt,o=Je("=",!1),s=Je("'",!1),v=/^[^'=+\-*\/&<>\^]/,c=et(["'","=","+","-","*","/","&","<",">","^"],!0,!1),i={type:"any"},p=Je("<>",!1),f=Je("<=",!1),y=Je(">=",!1),h=Je("<",!1),E=Je(">",!1),m=Je("&",!1),d=Je("+",!1),A=Je("-",!1),g=Je("*",!1),S=Je("/",!1),M=Je("^",!1),I=Je("{",!1),T=Je(";",!1),R=function(e,t){return t},C=Je("}",!1),N=Je(",",!1),b=function(e,t){return t},O=Je("(",!1),w=Je(")",!1),L=Je("TRUE",!1),D=Je("FALSE",!1),_=/^[a-zA-Z]/,U=et([["a","z"],["A","Z"]],!1,!1),x=/^[a-zA-Z0-9_]/,P=et([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),F=function(){return ze()},V=Je("!",!1),B=Je("[",!1),k=/^[a-zA-Z0-9_.]/,H=et([["a","z"],["A","Z"],["0","9"],"_","."],!1,!1),$=Je("]",!1),Q=Je("\\'",!1),z=/^[^']/,te=et(["'"],!0,!1),ue=Je("\\]",!1),re=/^[^\]]/,ne=et(["]"],!0,!1),se=Je("$",!1),ve=/^[A-Z]/,ce=et([["A","Z"]],!1,!1),ie=/^[1-9]/,pe=et([["1","9"]],!1,!1),fe=/^[0-9]/,ye=et([["0","9"]],!1,!1),Ee=Je("R",!1),de=Je("C",!1),Se=function(){return parseInt(ze(),10)},Me=Je(":",!1),Ie=function(e,t){return t},Te=function(e){return{type:ee,value:void 0}},Re=function(e,t){return t},Ce=/^[a-zA-Z0-9.]/,Ne=et([["a","z"],["A","Z"],["0","9"],"."],!1,!1),be=function(e,t,a){return a},Oe=function(e,t){return{type:ee,value:void 0}},we=function(e,t,a){return a},Le=Je(" ",!1),De=function(e){return ze()},_e=function(e,t){return ze()},Ue=Je('""',!1),xe=Je('"',!1),Pe=Je('\\"',!1),Fe=/^[^"]/,Ve=et(['"'],!0,!1),Be=tt("number"),Ge=Je(".",!1),Xe=Je("%",!1),Ye=tt("whitespace"),ke=/^[ \t\n\r]/,He=et([" ","\t","\n","\r"],!1,!1),$e=0,We=0,Ke=[{line:1,column:1}],qe=0,Qe=[],Ze=0;if("startRule"in a){if(!(a.startRule in n))throw new Error("Can't start parsing from rule \""+a.startRule+'".');l=n[a.startRule]}function ze(){return t.substring(We,$e)}function Je(e,t){return{type:"literal",text:e,ignoreCase:t}}function et(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function tt(e){return{type:"other",description:e}}function at(e){var a,u=Ke[e];if(u)return u;for(a=e-1;!Ke[a];)a--;for(u={line:(u=Ke[a]).line,column:u.column};a<e;)10===t.charCodeAt(a)?(u.line++,u.column=1):u.column++,a++;return Ke[e]=u,u}function ut(e,t){var a=at(e),u=at(t);return{start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:u.line,column:u.column}}}function rt(e){$e<qe||($e>qe&&(qe=$e,Qe=[]),Qe.push(e))}function nt(){var e;return(e=function(){var e,a,u;e=$e,61===t.charCodeAt($e)?(a="=",$e++):(a=r,0===Ze&&rt(o));a!==r&&(u=ot())!==r?(We=e,e=a=u):($e=e,e=r);return e}())===r&&(e=function(){var e,a;e=$e,39===t.charCodeAt($e)?(a="'",$e++):(a=r,0===Ze&&rt(s));a!==r&&lt()!==r?(We=e,a={type:q,value:ze().substring(1),meta:{type:X}},e=a):($e=e,e=r);return e}())===r&&(e=Tt())===r&&(e=function(){var e,a,u;e=$e,v.test(t.charAt($e))?(a=t.charAt($e),$e++):(a=r,0===Ze&&rt(c));a!==r?((u=lt())===r&&(u=null),u!==r?(We=e,a={type:q,value:ze(),meta:{type:Y}},e=a):($e=e,e=r)):($e=e,e=r);return e}())===r&&(e=function(){var e,t;e=$e,(t="")!==r&&(We=e,t={type:ee,value:null});return e=t}()),e}function lt(){var e,a;if(e=[],t.length>$e?(a=t.charAt($e),$e++):(a=r,0===Ze&&rt(i)),a!==r)for(;a!==r;)e.push(a),t.length>$e?(a=t.charAt($e),$e++):(a=r,0===Ze&&rt(i));else e=r;return e}function ot(){var e,a,u,n,l,s,v,c,i;if(e=$e,(a=st())!==r){for(u=[],n=$e,(l=Rt())!==r?(61===t.charCodeAt($e)?(s="=",$e++):(s=r,0===Ze&&rt(o)),s===r&&("<>"===t.substr($e,2)?(s="<>",$e+=2):(s=r,0===Ze&&rt(p)),s===r&&("<="===t.substr($e,2)?(s="<=",$e+=2):(s=r,0===Ze&&rt(f)),s===r&&(">="===t.substr($e,2)?(s=">=",$e+=2):(s=r,0===Ze&&rt(y)),s===r&&(60===t.charCodeAt($e)?(s="<",$e++):(s=r,0===Ze&&rt(h)),s===r&&(62===t.charCodeAt($e)?(s=">",$e++):(s=r,0===Ze&&rt(E))))))),s!==r&&(v=Rt())!==r&&(c=st())!==r?n=l=[l,s,v,c]:($e=n,n=r)):($e=n,n=r);n!==r;)u.push(n),n=$e,(l=Rt())!==r?(61===t.charCodeAt($e)?(s="=",$e++):(s=r,0===Ze&&rt(o)),s===r&&("<>"===t.substr($e,2)?(s="<>",$e+=2):(s=r,0===Ze&&rt(p)),s===r&&("<="===t.substr($e,2)?(s="<=",$e+=2):(s=r,0===Ze&&rt(f)),s===r&&(">="===t.substr($e,2)?(s=">=",$e+=2):(s=r,0===Ze&&rt(y)),s===r&&(60===t.charCodeAt($e)?(s="<",$e++):(s=r,0===Ze&&rt(h)),s===r&&(62===t.charCodeAt($e)?(s=">",$e++):(s=r,0===Ze&&rt(E))))))),s!==r&&(v=Rt())!==r&&(c=st())!==r?n=l=[l,s,v,c]:($e=n,n=r)):($e=n,n=r);u!==r?(We=e,i=a,e=a=u.reduce((function(e,t){return"="===t[1]?Ct(e,t[3],(e,t)=>e==t,Z,"=="):"<"===t[1]?Ct(e,t[3],(e,t)=>e<t,Z,"<"):">"===t[1]?Ct(e,t[3],(e,t)=>e>t,Z,">"):"<="===t[1]?Ct(e,t[3],(e,t)=>e<=t,Z,"<="):">="===t[1]?Ct(e,t[3],(e,t)=>e>=t,Z,">="):"<>"===t[1]?Ct(e,t[3],(e,t)=>e!=t,Z,"<>"):void 0}),i)):($e=e,e=r)}else $e=e,e=r;return e}function st(){var e,a,u,n,l,o,s,v,c;if(e=$e,(a=vt())!==r){for(u=[],n=$e,(l=Rt())!==r?(38===t.charCodeAt($e)?(o="&",$e++):(o=r,0===Ze&&rt(m)),o!==r&&(s=Rt())!==r&&(v=vt())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);n!==r;)u.push(n),n=$e,(l=Rt())!==r?(38===t.charCodeAt($e)?(o="&",$e++):(o=r,0===Ze&&rt(m)),o!==r&&(s=Rt())!==r&&(v=vt())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);u!==r?(We=e,c=a,e=a=u.reduce((function(e,t){if("&"===t[1])return Ct(e,t[3],(e,t)=>""+e+t,q,"&")}),c)):($e=e,e=r)}else $e=e,e=r;return e}function vt(){var e,a,u,n,l,o,s,v,c;if(e=$e,(a=ct())!==r){for(u=[],n=$e,(l=Rt())!==r?(43===t.charCodeAt($e)?(o="+",$e++):(o=r,0===Ze&&rt(d)),o===r&&(45===t.charCodeAt($e)?(o="-",$e++):(o=r,0===Ze&&rt(A))),o!==r&&(s=Rt())!==r&&(v=ct())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);n!==r;)u.push(n),n=$e,(l=Rt())!==r?(43===t.charCodeAt($e)?(o="+",$e++):(o=r,0===Ze&&rt(d)),o===r&&(45===t.charCodeAt($e)?(o="-",$e++):(o=r,0===Ze&&rt(A))),o!==r&&(s=Rt())!==r&&(v=ct())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);u!==r?(We=e,c=a,e=a=u.reduce((function(e,t){return"+"===t[1]?Ct(e,t[3],(e,t)=>e+t,j,"+"):"-"===t[1]?Ct(e,t[3],(e,t)=>e-t,j,"-"):void 0}),c)):($e=e,e=r)}else $e=e,e=r;return e}function ct(){var e,a,u,n,l,o,s,v,c;if(e=$e,(a=it())!==r){for(u=[],n=$e,(l=Rt())!==r?(42===t.charCodeAt($e)?(o="*",$e++):(o=r,0===Ze&&rt(g)),o===r&&(47===t.charCodeAt($e)?(o="/",$e++):(o=r,0===Ze&&rt(S))),o!==r&&(s=Rt())!==r&&(v=it())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);n!==r;)u.push(n),n=$e,(l=Rt())!==r?(42===t.charCodeAt($e)?(o="*",$e++):(o=r,0===Ze&&rt(g)),o===r&&(47===t.charCodeAt($e)?(o="/",$e++):(o=r,0===Ze&&rt(S))),o!==r&&(s=Rt())!==r&&(v=it())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);u!==r?(We=e,c=a,e=a=u.reduce((function(e,t){return"*"===t[1]?Ct(e,t[3],(e,t)=>e*t,j,"*"):"/"===t[1]?Ct(e,t[3],(e,t)=>e/t,j,"/"):void 0}),c)):($e=e,e=r)}else $e=e,e=r;return e}function it(){var e,a,u,n,l,o,s,v,c;if(e=$e,(a=yt())!==r){for(u=[],n=$e,(l=Rt())!==r?(94===t.charCodeAt($e)?(o="^",$e++):(o=r,0===Ze&&rt(M)),o!==r&&(s=Rt())!==r&&(v=yt())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);n!==r;)u.push(n),n=$e,(l=Rt())!==r?(94===t.charCodeAt($e)?(o="^",$e++):(o=r,0===Ze&&rt(M)),o!==r&&(s=Rt())!==r&&(v=yt())!==r?n=l=[l,o,s,v]:($e=n,n=r)):($e=n,n=r);u!==r?(We=e,c=a,e=a=u.reduce((function(e,t){if("^"===t[1])return Ct(e,t[3],(e,t)=>Math.pow(e,t),j,"^")}),c)):($e=e,e=r)}else $e=e,e=r;return e}function pt(){var e,a,u,n,l,o,s;if(e=$e,123===t.charCodeAt($e)?(a="{",$e++):(a=r,0===Ze&&rt(I)),a!==r)if((u=ft())!==r){for(n=[],l=$e,59===t.charCodeAt($e)?(o=";",$e++):(o=r,0===Ze&&rt(T)),o!==r&&(s=ft())!==r?(We=l,l=o=R(0,s)):($e=l,l=r);l!==r;)n.push(l),l=$e,59===t.charCodeAt($e)?(o=";",$e++):(o=r,0===Ze&&rt(T)),o!==r&&(s=ft())!==r?(We=l,l=o=R(0,s)):($e=l,l=r);n!==r?(125===t.charCodeAt($e)?(l="}",$e++):(l=r,0===Ze&&rt(C)),l!==r?(We=e,e=a=function(e,t){const a=e.map(e=>e[oe]||[]);return t.length?{type:K,value:[e,...t],meta:{type:me},[oe]:[].concat(...a)}:{type:W,value:e,meta:{type:me},[oe]:[].concat(...a)}}(u,n)):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r;return e}function ft(){var e,a,u,n,l,o,s;if(e=$e,(a=ht())===r&&(a=Et())===r&&(a=It())===r&&(a=Tt()),a===r&&(a=null),a!==r){for(u=[],n=$e,44===t.charCodeAt($e)?(l=",",$e++):(l=r,0===Ze&&rt(N)),l!==r?((o=ht())===r&&(o=Et())===r&&(o=It())===r&&(o=Tt()),o!==r?(We=n,n=l=b(0,o)):($e=n,n=r)):($e=n,n=r);n!==r;)u.push(n),n=$e,44===t.charCodeAt($e)?(l=",",$e++):(l=r,0===Ze&&rt(N)),l!==r?((o=ht())===r&&(o=Et())===r&&(o=It())===r&&(o=Tt()),o!==r?(We=n,n=l=b(0,o)):($e=n,n=r)):($e=n,n=r);u!==r?(We=e,s=u,e=a=[a||{type:ee},...s]):($e=e,e=r)}else $e=e,e=r;return e}function yt(){var e,a,u,n;return e=$e,40===t.charCodeAt($e)?(a="(",$e++):(a=r,0===Ze&&rt(O)),a!==r&&Rt()!==r&&(u=ot())!==r&&Rt()!==r?(41===t.charCodeAt($e)?(n=")",$e++):(n=r,0===Ze&&rt(w)),n!==r?(We=e,e=a=u):($e=e,e=r)):($e=e,e=r),e===r&&(e=pt())===r&&(e=function(){var e,a,u,n,l,o,s,v,c,i,p;e=$e,a=$e,_.test(t.charAt($e))?(u=t.charAt($e),$e++):(u=r,0===Ze&&rt(U));if(u!==r){for(n=[],Ce.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(Ne));l!==r;)n.push(l),Ce.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(Ne));n!==r?(We=a,u=ze(),a=u):($e=a,a=r)}else $e=a,a=r;if(a!==r)if((u=Rt())!==r)if(40===t.charCodeAt($e)?(n="(",$e++):(n=r,0===Ze&&rt(O)),n!==r)if((l=ot())===r&&(l=null),l!==r){for(o=[],s=$e,(v=Rt())!==r?(44===t.charCodeAt($e)?(c=",",$e++):(c=r,0===Ze&&rt(N)),c!==r&&Rt()!==r?(i=$e,(p=ot())!==r&&(We=i,p=be(0,0,p)),(i=p)===r&&(i=$e,(p="")!==r&&(We=i,p=Oe()),i=p),i!==r&&(p=Rt())!==r?(We=s,v=we(0,0,i),s=v):($e=s,s=r)):($e=s,s=r)):($e=s,s=r);s!==r;)o.push(s),s=$e,(v=Rt())!==r?(44===t.charCodeAt($e)?(c=",",$e++):(c=r,0===Ze&&rt(N)),c!==r&&Rt()!==r?(i=$e,(p=ot())!==r&&(We=i,p=be(0,0,p)),(i=p)===r&&(i=$e,(p="")!==r&&(We=i,p=Oe()),i=p),i!==r&&(p=Rt())!==r?(We=s,v=we(0,0,i),s=v):($e=s,s=r)):($e=s,s=r)):($e=s,s=r);o!==r?(41===t.charCodeAt($e)?(s=")",$e++):(s=r,0===Ze&&rt(w)),s!==r?(We=e,a=function(e,t,a){if(Nt[e]){const u=[t,...a].map(e=>e||{type:ee,[oe]:[]}),r=u.reduce((e,t)=>e.concat(t[oe]||[]),[]);try{const t=(0,Nt[e])(u,{...Ut,currentcell:Ot,name:e,raw:ze(),allowUnsafe:Dt,functions:Nt,table:xt,parser:Lt,[oe]:r});if(!t)throw new Error("Function '"+e+"' did not return a result! Check the implementation!");return t[le]={function:e,arguments:u},t[oe]=r.concat(t[oe]||[]),t}catch(t){const a=u.find(e=>e&&e.type===ae),n={type:ae,value:a&&a.value||t.name+" in "+e+': "'+t.message+'"',meta:{error_value:a,internal_error:t}};return n[oe]=r,n}}if(Nt[e.toUpperCase()])return{type:ae,value:he,meta:{error:"Unknown function "+e+". Did you mean "+e.toUpperCase()+"?"}};const u=Object.keys(Nt).find(t=>t.toUpperCase()===e.toUpperCase());return u?{type:ae,value:he,meta:{error:"Unknown function "+e+". Did you mean "+u+"?"}}:{type:ae,value:he,meta:{error:"Unknown function "+e}}}(a,l,o),e=a):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r;else $e=e,e=r;else $e=e,e=r;return e}())===r&&(e=function(){var e,a,u,n,l,o,s,v,c,i;if(e=$e,(a=Rt())!==r)if(40===t.charCodeAt($e)?(u="(",$e++):(u=r,0===Ze&&rt(O)),u!==r)if((n=ot())!==r){for(l=[],o=$e,(s=Rt())!==r?(44===t.charCodeAt($e)?(v=",",$e++):(v=r,0===Ze&&rt(N)),v!==r&&Rt()!==r?(c=$e,(i=ot())!==r&&(We=c,i=Ie(0,i)),(c=i)===r&&(c=$e,(i="")!==r&&(We=c,i=Te()),c=i),c!==r&&(i=Rt())!==r?(We=o,s=Re(0,c),o=s):($e=o,o=r)):($e=o,o=r)):($e=o,o=r);o!==r;)l.push(o),o=$e,(s=Rt())!==r?(44===t.charCodeAt($e)?(v=",",$e++):(v=r,0===Ze&&rt(N)),v!==r&&Rt()!==r?(c=$e,(i=ot())!==r&&(We=c,i=Ie(0,i)),(c=i)===r&&(c=$e,(i="")!==r&&(We=c,i=Te()),c=i),c!==r&&(i=Rt())!==r?(We=o,s=Re(0,c),o=s):($e=o,o=r)):($e=o,o=r)):($e=o,o=r);l!==r?(41===t.charCodeAt($e)?(o=")",$e++):(o=r,0===Ze&&rt(w)),o!==r&&(s=Rt())!==r?(We=e,p=l,a={type:J,value:[n,...p]},e=a):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r;else $e=e,e=r;var p;return e}())===r&&(e=function(){var e,a,u,n,l;e=$e,(a=Rt())!==r&&(u=Mt())!==r?(32===t.charCodeAt($e)?(n=" ",$e++):(n=r,0===Ze&&rt(Le)),n!==r&&(l=Mt())!==r&&Rt()!==r?(We=e,a=function(e,t){if(e.type!==W||t.type!==W)throw new Error("An intersection between anything else but LISTs is currently not supported. Expected LIST, LIST, found "+e.type+", "+t.type);const a=e.value.filter(e=>t.value.some(t=>t.meta.row===e.meta.row&&t.meta.col===e.meta.col)),u=[].concat(...a.map(e=>e[oe]||[]));return{type:W,value:a,meta:{type:Ae},[oe]:u}}(u,l),e=a):($e=e,e=r)):($e=e,e=r);return e}())===r&&(e=ht())===r&&(e=Et())===r&&(e=function(){var e,a,u,n,l,o;e=$e,(a=Rt())!==r?((u=mt())===r&&(u=null),u!==r&&(n=gt())!==r?(58===t.charCodeAt($e)?(l=":",$e++):(l=r,0===Ze&&rt(Me)),l!==r&&(o=gt())!==r&&Rt()!==r?(We=e,a=function(e,t,a){const u=e||{};let r=xt;u.workbook&&(r=r.getWorkbook(u.workbook)),u.sheet&&(r=r.getWorkbook(u.sheet));const n={...u,type:Ae},l=[],o=[];for(var s=t.meta.row;s<=a.meta.row;s++){const e=[];for(var v=t.meta.col;v<=a.meta.col;v++){const t=r.getRow(s-1,{...n,row:s-1,col:v-1}).getCol(v-1,{...n,row:s-1,col:v-1})||{value:null,type:"ERROR"};o.push(...t[oe]||[]),e.push({...t,meta:{...u,type:G,row:s,col:v}})}l.push(e)}return 1===l.length?{type:W,value:l[0],meta:n,[oe]:o}:l.every(e=>1===e.length)?{type:W,value:l.map(e=>e[0]),meta:n,[oe]:o}:{type:K,value:l,meta:n,[oe]:o}}(u,n,o),e=a):($e=e,e=r)):($e=e,e=r)):($e=e,e=r);return e}())===r&&(e=gt())===r&&(e=function(){var e,a,u,n,l,o,s,v;if(e=$e,(a=Rt())!==r)if((u=mt())===r&&(u=null),u!==r){if(n=$e,l=[],ve.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(ce)),o!==r)for(;o!==r;)l.push(o),ve.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(ce));else l=r;if(l!==r&&(We=n,l=De()),(n=l)!==r)if(58===t.charCodeAt($e)?(l=":",$e++):(l=r,0===Ze&&rt(Me)),l!==r){if(o=$e,s=[],ve.test(t.charAt($e))?(v=t.charAt($e),$e++):(v=r,0===Ze&&rt(ce)),v!==r)for(;v!==r;)s.push(v),ve.test(t.charAt($e))?(v=t.charAt($e),$e++):(v=r,0===Ze&&rt(ce));else s=r;s!==r&&(We=o,s=_e()),(o=s)!==r&&(s=Rt())!==r?(We=e,a=function(e,t,a){if(t!==a)throw new Error("Infinite row-ranges can't span multiple columns \""+t+":"+a+'"');const u=e||{};let r=xt;u.workbook&&(r=r.getWorkbook(u.workbook)),u.sheet&&(r=r.getWorkbook(u.sheet));const n=t.split("").reduce((e,t)=>26*e+t.charCodeAt(0)-64,0),l={...u,type:Ae},o=r.getCol(n-1,l).all({col:n-1},l),s=[{col:n,row:"*"}].concat(...o.map(e=>e[oe]||[]));return{type:W,value:o,meta:l,[oe]:s}}(u,n,o),e=a):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r}else $e=e,e=r;else $e=e,e=r;return e}())===r&&(e=function(){var e,a,u,n,l,o,s,v,c;if(e=$e,(a=Rt())!==r)if((u=mt())===r&&(u=null),u!==r){if(n=$e,ie.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(pe)),l!==r){for(o=[],fe.test(t.charAt($e))?(s=t.charAt($e),$e++):(s=r,0===Ze&&rt(ye));s!==r;)o.push(s),fe.test(t.charAt($e))?(s=t.charAt($e),$e++):(s=r,0===Ze&&rt(ye));o!==r?(We=n,l=De(),n=l):($e=n,n=r)}else $e=n,n=r;if(n!==r)if(58===t.charCodeAt($e)?(l=":",$e++):(l=r,0===Ze&&rt(Me)),l!==r){if(o=$e,ie.test(t.charAt($e))?(s=t.charAt($e),$e++):(s=r,0===Ze&&rt(pe)),s!==r){for(v=[],fe.test(t.charAt($e))?(c=t.charAt($e),$e++):(c=r,0===Ze&&rt(ye));c!==r;)v.push(c),fe.test(t.charAt($e))?(c=t.charAt($e),$e++):(c=r,0===Ze&&rt(ye));v!==r?(We=o,s=_e(),o=s):($e=o,o=r)}else $e=o,o=r;o!==r&&(s=Rt())!==r?(We=e,a=function(e,t,a){if(t!==a)throw new Error("Infinite row-ranges can't span multiple columns \""+t+":"+a+'"');const u=e||{};let r=xt;u.workbook&&(r=r.getWorkbook(u.workbook)),u.sheet&&(r=r.getWorkbook(u.sheet));const n=parseInt(t,10),l={...r,type:Ae},o=r.getRow(n-1,l).all({row:n-1},l),s=[{row:n,col:"*"}].concat(...o.map(e=>e[oe]||[]));return{type:W,value:o,meta:l,[oe]:s}}(u,n,o),e=a):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r}else $e=e,e=r;else $e=e,e=r;return e}())===r&&(e=function(){var e,t;e=$e,Rt()!==r&&(t=Mt())!==r&&Rt()!==r?(We=e,e=t):($e=e,e=r);return e}())===r&&(e=At())===r&&(e=It())===r&&(e=Tt()),e}function ht(){var e,a;return e=$e,Rt()!==r?("TRUE"===t.substr($e,4)?(a="TRUE",$e+=4):(a=r,0===Ze&&rt(L)),a!==r&&Rt()!==r?(We=e,e={type:Z,value:!0,[oe]:[]}):($e=e,e=r)):($e=e,e=r),e}function Et(){var e,a;return e=$e,Rt()!==r?("FALSE"===t.substr($e,5)?(a="FALSE",$e+=5):(a=r,0===Ze&&rt(D)),a!==r&&Rt()!==r?(We=e,e={type:Z,value:!1,[oe]:[]}):($e=e,e=r)):($e=e,e=r),e}function mt(){var e;return(e=function(){var e,a,u,n,l,o,v,c;e=$e,39===t.charCodeAt($e)?(a="'",$e++):(a=r,0===Ze&&rt(s));if(a!==r)if(91===t.charCodeAt($e)?(u="[",$e++):(u=r,0===Ze&&rt(B)),u!==r){if(n=$e,l=[],"\\]"===t.substr($e,2)?(o="\\]",$e+=2):(o=r,0===Ze&&rt(ue)),o===r&&(re.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(ne))),o!==r)for(;o!==r;)l.push(o),"\\]"===t.substr($e,2)?(o="\\]",$e+=2):(o=r,0===Ze&&rt(ue)),o===r&&(re.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(ne)));else l=r;if(l!==r&&(We=n,l=ze().replace(/\\\]/g,"]")),(n=l)!==r)if(93===t.charCodeAt($e)?(l="]",$e++):(l=r,0===Ze&&rt($)),l!==r){if(o=$e,v=[],"\\'"===t.substr($e,2)?(c="\\'",$e+=2):(c=r,0===Ze&&rt(Q)),c===r&&(z.test(t.charAt($e))?(c=t.charAt($e),$e++):(c=r,0===Ze&&rt(te))),c!==r)for(;c!==r;)v.push(c),"\\'"===t.substr($e,2)?(c="\\'",$e+=2):(c=r,0===Ze&&rt(Q)),c===r&&(z.test(t.charAt($e))?(c=t.charAt($e),$e++):(c=r,0===Ze&&rt(te)));else v=r;v!==r&&(We=o,v=ze().replace(/\\'/g,"'")),(o=v)!==r?(39===t.charCodeAt($e)?(v="'",$e++):(v=r,0===Ze&&rt(s)),v!==r?(33===t.charCodeAt($e)?(c="!",$e++):(c=r,0===Ze&&rt(V)),c!==r?(We=e,e=a={sheet:o,workbook:n}):($e=e,e=r)):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r}else $e=e,e=r;else $e=e,e=r;return e}())===r&&(e=function(){var e,a,u,n,l;e=$e,39===t.charCodeAt($e)?(a="'",$e++):(a=r,0===Ze&&rt(s));if(a!==r){if(u=$e,n=[],"\\'"===t.substr($e,2)?(l="\\'",$e+=2):(l=r,0===Ze&&rt(Q)),l===r&&(z.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(te))),l!==r)for(;l!==r;)n.push(l),"\\'"===t.substr($e,2)?(l="\\'",$e+=2):(l=r,0===Ze&&rt(Q)),l===r&&(z.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(te)));else n=r;n!==r&&(We=u,n=ze().replace(/\\'/g,"'")),(u=n)!==r?(39===t.charCodeAt($e)?(n="'",$e++):(n=r,0===Ze&&rt(s)),n!==r?(33===t.charCodeAt($e)?(l="!",$e++):(l=r,0===Ze&&rt(V)),l!==r?(We=e,e=a={sheet:u}):($e=e,e=r)):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;return e}())===r&&(e=function(){var e,a,u,n,l,o;e=$e,91===t.charCodeAt($e)?(a="[",$e++):(a=r,0===Ze&&rt(B));if(a!==r){if(u=$e,_.test(t.charAt($e))?(n=t.charAt($e),$e++):(n=r,0===Ze&&rt(U)),n!==r){for(l=[],k.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(H));o!==r;)l.push(o),k.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(H));l!==r?(We=u,n=F(),u=n):($e=u,u=r)}else $e=u,u=r;u!==r?(93===t.charCodeAt($e)?(n="]",$e++):(n=r,0===Ze&&rt($)),n!==r&&(l=dt())!==r?(We=e,s=u,v=l,a={...v,workbook:s},e=a):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;var s,v;return e}())===r&&(e=dt()),e}function dt(){var e,a,u,n,l;if(e=$e,a=$e,_.test(t.charAt($e))?(u=t.charAt($e),$e++):(u=r,0===Ze&&rt(U)),u!==r){for(n=[],x.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(P));l!==r;)n.push(l),x.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(P));n!==r?(We=a,a=u=F()):($e=a,a=r)}else $e=a,a=r;return a!==r?(33===t.charCodeAt($e)?(u="!",$e++):(u=r,0===Ze&&rt(V)),u!==r?(We=e,e=a={sheet:a}):($e=e,e=r)):($e=e,e=r),e}function At(){var e,a,u,n,l,o,s,v,c;if(e=$e,Rt()!==r)if((a=mt())===r&&(a=null),a!==r)if(36===t.charCodeAt($e)?(u="$",$e++):(u=r,0===Ze&&rt(se)),u===r&&(u=null),u!==r){if(n=[],ve.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(ce)),l!==r)for(;l!==r;)n.push(l),ve.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(ce));else n=r;if(n!==r)if(36===t.charCodeAt($e)?(l="$",$e++):(l=r,0===Ze&&rt(se)),l===r&&(l=null),l!==r){if(o=$e,ie.test(t.charAt($e))?(s=t.charAt($e),$e++):(s=r,0===Ze&&rt(pe)),s!==r){for(v=[],fe.test(t.charAt($e))?(c=t.charAt($e),$e++):(c=r,0===Ze&&rt(ye));c!==r;)v.push(c),fe.test(t.charAt($e))?(c=t.charAt($e),$e++):(c=r,0===Ze&&rt(ye));v!==r?(We=o,o=s=parseInt(ze(),10)):($e=o,o=r)}else $e=o,o=r;o!==r&&(s=Rt())!==r?(We=e,e=function(e,t,a,u,r){const n=a.reduce((e,t)=>26*e+t.charCodeAt(0)-64,0),l=e||{};let o=xt;l.workbook&&(o=o.getWorkbook(l.workbook)),l.sheet&&(o=o.getWorkbook(l.sheet));const s={...l,row:r-1,col:n-1,type:Ae},v=o.getRow(r-1,s).getCol(n-1,s)||{value:null,type:"ERROR"},c=v[oe]||[];return{...v,type:v.type,meta:{...l,type:G,row:r,col:n,absrow:"$"===u,abscol:"$"===t},value:v.value,[oe]:c.concat([{row:r,col:n}])}}(a,u,n,l,o)):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r}else $e=e,e=r;else $e=e,e=r;else $e=e,e=r;return e}function gt(){var e,a,u,n,l,o;return e=$e,Rt()!==r?((a=mt())===r&&(a=null),a!==r?(82===t.charCodeAt($e)?(u="R",$e++):(u=r,0===Ze&&rt(Ee)),u!==r&&(n=St())!==r?(67===t.charCodeAt($e)?(l="C",$e++):(l=r,0===Ze&&rt(de)),l!==r&&(o=St())!==r&&Rt()!==r?(We=e,e=function(e,t,a){const{row:u,col:r}=Ot;let n=t.absolute?t.cell:u+t.cell,l=a.absolute?a.cell:r+a.cell;const o=e||{};let s=xt;o.workbook&&(s=s.getWorkbook(o.workbook)),o.sheet&&(s=s.getWorkbook(o.sheet));const v={...o,row:n-1,col:l-1,type:Ae},c=s.getRow(n-1,v).getCol(l-1,v)||{value:null,type:"ERROR"},i=c[oe]||[];return{...c,type:c.type,meta:{...o,type:G,row:n,col:l,absrow:t.absolute,abscol:a.absolute,notation:"R1C1"},value:c.value,[oe]:i.concat([{row:t,col:l}])}}(a,n,o)):($e=e,e=r)):($e=e,e=r)):($e=e,e=r)):($e=e,e=r),e}function St(){var e,a,u,n,l,o;if(e=$e,91===t.charCodeAt($e)?(a="[",$e++):(a=r,0===Ze&&rt(B)),a!==r){if(u=$e,ie.test(t.charAt($e))?(n=t.charAt($e),$e++):(n=r,0===Ze&&rt(pe)),n!==r){for(l=[],fe.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(ye));o!==r;)l.push(o),fe.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(ye));l!==r?(We=u,u=n=Se()):($e=u,u=r)}else $e=u,u=r;u!==r?(93===t.charCodeAt($e)?(n="]",$e++):(n=r,0===Ze&&rt($)),n!==r?(We=e,e=a={cell:u,absolute:!0}):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;if(e===r){if(e=$e,a=$e,ie.test(t.charAt($e))?(u=t.charAt($e),$e++):(u=r,0===Ze&&rt(pe)),u!==r){for(n=[],fe.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(ye));l!==r;)n.push(l),fe.test(t.charAt($e))?(l=t.charAt($e),$e++):(l=r,0===Ze&&rt(ye));n!==r?(We=a,a=u=Se()):($e=a,a=r)}else $e=a,a=r;a!==r&&(We=e,a=function(e){return{cell:e,absolute:!1}}(a)),e=a}return e}function Mt(){var e,a,u,n;return e=$e,(a=At())!==r?(58===t.charCodeAt($e)?(u=":",$e++):(u=r,0===Ze&&rt(Me)),u!==r&&(n=At())!==r?(We=e,e=a=function(e,t){const a=[];let u=e;e.type===ae&&e.value===ge&&(u={...e.meta,meta:e.meta});let r=t;t.type===ae&&t.value===ge&&(r={...t.meta,meta:t.meta});let n=xt;const l={};u.meta.workbook&&(n=n.getWorkbook(u.meta.workbook),l.workbook=u.meta.workbook),u.meta.sheet&&(n=n.getWorkbook(u.meta.sheet),l.sheet=u.meta.sheet);const o=[];let s=!1;for(let e=u.meta.row;e<=r.meta.row;e++){const t=[];for(let a=u.meta.col;a<=r.meta.col;a++){const r=n.getRow(e-1,{...l,type:Ae}).getCol(a-1,{...l,type:Ae})||{value:null,type:"ERROR"};o.push(...r[oe]||[]),o.push({row:e,col:a}),r.type===ae&&r.value===ge&&(s=!0),t.push({...r,meta:{...u.meta,type:G,row:e,col:a}})}a.push(t)}if(1===a.length){const e={type:W,value:a[0],rowspan:1,colspan:a[0].length,meta:{...l,type:Ae},[oe]:o};return s?{type:ae,value:ge,meta:e,[oe]:o}:e}if(a.every(e=>1===e.length)){const e={type:W,value:a.map(e=>e[0]),rowspan:a.length,colspan:1,meta:{...l,type:Ae},[oe]:o};return s?{type:ae,value:ge,meta:e,[oe]:o}:e}const v={type:K,value:a,get rowspan(){return a.length},get colspan(){return a[0].length},meta:{...l,type:Ae},[oe]:o};return e.type===ae&&e.value===ge?{...e,type:ae,value:ge,meta:v,[oe]:o}:s?{type:ae,value:ge,meta:v,[oe]:o}:t.type===ae&&t.value===ge?{...t,type:ae,value:ge,meta:v,[oe]:o}:v}(a,n)):($e=e,e=r)):($e=e,e=r),e}function It(){var e,a,u,n,l,o;if(e=$e,'""'===t.substr($e,2)?(a='""',$e+=2):(a=r,0===Ze&&rt(Ue)),a!==r&&(We=e,a={type:q,value:"",meta:{empty:!0}}),(e=a)===r)if(e=$e,(a=Rt())!==r)if(34===t.charCodeAt($e)?(u='"',$e++):(u=r,0===Ze&&rt(xe)),u!==r){for(n=$e,l=[],'\\"'===t.substr($e,2)?(o='\\"',$e+=2):(o=r,0===Ze&&rt(Pe)),o===r&&(Fe.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(Ve)));o!==r;)l.push(o),'\\"'===t.substr($e,2)?(o='\\"',$e+=2):(o=r,0===Ze&&rt(Pe)),o===r&&(Fe.test(t.charAt($e))?(o=t.charAt($e),$e++):(o=r,0===Ze&&rt(Ve)));l!==r&&(We=n,l=ze().replace(/\\\"/g,'"')),(n=l)!==r?(34===t.charCodeAt($e)?(l='"',$e++):(l=r,0===Ze&&rt(xe)),l!==r&&(o=Rt())!==r?(We=e,e=a={type:q,value:n}):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r;else $e=e,e=r;return e}function Tt(){var e,a;return Ze++,e=$e,Rt()!==r&&(a=function(){var e,a,u,n,l,o,s;e=$e,43===t.charCodeAt($e)?(a="+",$e++):(a=r,0===Ze&&rt(d));a===r&&(45===t.charCodeAt($e)?(a="-",$e++):(a=r,0===Ze&&rt(A)),a===r&&(a=""));if(a!==r){if(u=[],fe.test(t.charAt($e))?(n=t.charAt($e),$e++):(n=r,0===Ze&&rt(ye)),n!==r)for(;n!==r;)u.push(n),fe.test(t.charAt($e))?(n=t.charAt($e),$e++):(n=r,0===Ze&&rt(ye));else u=r;if(u!==r){if(n=$e,46===t.charCodeAt($e)?(l=".",$e++):(l=r,0===Ze&&rt(Ge)),l!==r){if(o=[],fe.test(t.charAt($e))?(s=t.charAt($e),$e++):(s=r,0===Ze&&rt(ye)),s!==r)for(;s!==r;)o.push(s),fe.test(t.charAt($e))?(s=t.charAt($e),$e++):(s=r,0===Ze&&rt(ye));else o=r;o!==r?n=l=[l,o]:($e=n,n=r)}else $e=n,n=r;n===r&&(n=null),n!==r?(37===t.charCodeAt($e)?(l="%",$e++):(l=r,0===Ze&&rt(Xe)),l===r&&(l=null),l!==r?(We=e,a={type:j,value:("%"===l?.01:1)*parseFloat(ze(),10)},e=a):($e=e,e=r)):($e=e,e=r)}else $e=e,e=r}else $e=e,e=r;return e}())!==r&&Rt()!==r?(We=e,e=a):($e=e,e=r),Ze--,e===r&&(r,0===Ze&&rt(Be)),e}function Rt(){var e,a;for(Ze++,e=[],ke.test(t.charAt($e))?(a=t.charAt($e),$e++):(a=r,0===Ze&&rt(He));a!==r;)e.push(a),ke.test(t.charAt($e))?(a=t.charAt($e),$e++):(a=r,0===Ze&&rt(He));return Ze--,e===r&&(a=r,0===Ze&&rt(Ye)),e}const Ct=(e,t,a,u,r)=>{const{value:n,type:l,meta:{type:o}={}}=e,{value:s,type:v,meta:{type:c}={}}=t;if(l===ae){const t=new Error(n.description);throw t.value=e,t}if(v===ae){const e=new Error(s.description);throw e.value=t,e}const i=[...e[oe]||[],...t[oe]||[]],p={left:e.meta||{},right:t.meta||{},operation:r};return l===W&&v===j?{type:W,value:n.map(({value:e,meta:t={},...r},n)=>({...r,type:u,value:a(e,s),meta:Object.assign(p,{item:t,idx:n}),[oe]:i}))}:l===j&&v===W?{type:W,value:s.map(({value:e,meta:t={},...r},l)=>({...r,type:u,value:a(n,e),meta:Object.assign(p,{item:t,idx:l}),[oe]:i}))}:l===W&&v===W?{type:W,value:n.map(({value:e,...t},r)=>({...t,...s[r],meta:{...p,item:{left:t.meta||{},right:s[r].meta},idx:r},type:u,value:a(e,s[r].value),[oe]:i}))}:{...e,...t,type:u,value:a(n,s),meta:p,[oe]:i}},Nt=je;let bt=a._context,Ot=a._currentcell,wt=a._calledBy||[],Lt=a._self;const Dt=a.allowUnsafe||!1,_t=wt.concat([Ot]),Ut={calledBy:_t},xt={getWorkbook:e=>xt,getSheet:e=>xt,getRow:e=>({getCol:t=>_t.some(({row:a,col:u})=>e===a&&t===u)?{type:ae,value:ge,chain:[{col:t,row:e}].concat(_t),meta:{}}:bt.getRow(e,Ut).getCol(t,Ut),all:()=>{const t=_t.find(({row:t})=>e===t);return t?{type:ae,value:ge,chain:[t].concat(_t),meta:{}}:bt.getRow(e,Ut).all(Ut)}}),getCol:e=>({getRow:t=>_t.some(({row:a,col:u})=>t===a&&e===u)?{type:ae,value:ge,chain:[{col:e,row:t}].concat(_t),meta:{}}:bt.getCol(e,Ut).getRow(t,Ut),all:()=>{const t=_t.find(({col:t})=>e===t);return t?{type:ae,value:ge,chain:[t].concat(_t),meta:{}}:bt.getCol(e,Ut).all(Ut)}})};if((u=l())!==r&&$e===t.length)return u;throw u!==r&&$e<t.length&&rt({type:"end"}),Pt=Qe,Ft=qe<t.length?t.charAt(qe):null,Vt=qe<t.length?ut(qe,qe+1):ut(qe,qe),new e(e.buildMessage(Pt,Ft),Pt,Ft,Vt);var Pt,Ft,Vt}}}();const We=Symbol("CELL_ACTION");class Ke{constructor(){this.listeners={}}addEventListener(e,t,a){return e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push([t,a]),this.removeEventListener.bind(this,e,t,a)}removeEventListener(e,t,a){if(e in this.listeners){var u=this.listeners[e];for(let e of u){const[r,n]=e;if(r===t){const e=Object.keys(a),t=Object.keys(n);if(e.length===t.length&&e.every(a=>e[a]===t[a]))return void u.splice(i,1)}}}}dispatchEvent(e){if(!(e.type in this.listeners))return!0;const t=this.listeners[e.type].slice();for(let[a,u={}]of t){const{capture:t=!0===u,once:r=!1,passive:n=!1}=u;a.call(this,e,{capture:t,once:r,passive:n}),r&&this.removeEventListener(e.type,a,u)}return!e.defaultPrevented}}const qe=new class extends Ke{constructor({parser:e=$e}={parser:$e}){super(),this.cells=[],this.parser=e}register(e){this.cells.push(e)}},Qe=({row:e,col:t})=>({row:a,col:u})=>a===e&&u===t,Ze=()=>{};class ze extends Ke{constructor({name:e,onUpdate:t=(()=>null),table:a=qe,row:u,col:r,_value:n="",formula:l="",allowUnsafe:o=!1}){super(),this.references=[],this.lastRun=null,this.expression="",this.name=e||`${String.fromCharCode(65+r)}${u+1}`,this.onUpdate=t,this.table=a,this.table.register(this),this.row=u,this.col=r,this.value={value:n,type:this.table.parser.NULL},this.formula=l,this.onTableChange=this.onTableChange.bind(this),this.refresh=this.refresh.bind(this),this.update=this.update.bind(this),this.destroy=this.destroy.bind(this),this.allowUnsafe=o,this.onDestroy=this.table.addEventListener(We,this.onTableChange)}destroy(){this.dispatchEvent({type:"destroy"}),this.onDestroy()}refresh(e){this._update(void 0,e)}update(e){this._update(e.target.value)}_update(e=this.formula,{calledBy:t}={}){const a={getCell:({row:e,col:t},{calledBy:a})=>this.table.cells.find(Qe({row:e,col:t})).value,getRow:(e,{calledBy:t})=>({getCol:(t,{calledBy:a})=>this.table.cells.find(Qe({row:e,col:t})).value,all:({calledBy:t},{calledBy:a}={})=>this.table.filter(({row:t})=>e===t).map(({value:e})=>e)}),getCol:(e,{calledBy:t})=>({getRow:(t,{calledBy:a})=>this.table.cells.find(Qe({row:t,col:e})).value,all:({calledBy:t},{calledBy:a}={})=>this.table.cells.filter(({col:t})=>e===t).map(({value:e})=>e)})};console.log(`Updating cell ${this.name} value with `,t);const u={_context:a,_currentcell:{row:this.row,col:this.col},_calledBy:t||[],allowUnsafe:this.allowUnsafe};let r;try{r=this.table.parser.parse(e,{...u,_self:(e,t)=>this.table.parser.parse(e,{...u})})}catch(e){r=e.value||e}r instanceof Error&&(console.error(`Formula ${e} returned unexpected error`,r),r={type:"Runtime Error",value:`${r.name}: ${r.message}`}),this.value=r,this.formula=e,this.references=r&&r[this.table.parser.CELL_TRACE]||[];const n={value:this.value,formula:this.formula,meta:{row:this.row,col:this.col,cell:this,calledBy:this.references}};this.table.dispatchEvent({type:We,...n}),this.table.dispatchEvent({type:"change",...n});const l={value:this.value,formula:this.formula};return this.onUpdate.call(this,l,this),this.dispatchEvent({type:"change",...n}),l}subscribe(e,t,a){const u=e.next||e,r=(e.error,e.complete||a||Ze),n=this.addEventListener("change",e=>{u(e)}),l=this.addEventListener("destroy",e=>{r()});let o=!1;const s={unsubscribe:()=>{n(),l(),o=!0},get closed(){return o}};return e.start&&e.start(s),s}onTableChange(e){if(e.type===We){if(e.meta.row===this.row&&e.meta.col===this.col)return;if(console.log(this.name,this.references),this.references.some(({row:t,col:a})=>!("*"!==t&&e.meta.row!==t-1||"*"!==a&&a-1!==e.meta.col))){if(e.value.value===this.table.parser.CIRCULAR)return void(this.value=e.value);this.refresh({calledBy:e.meta.calledBy||[]})}}}}function Je(t){let a,u,r,n,o,i;return{c(){a=f("div"),u=f("input"),n=h(),o=f("input"),E(u,"class","formula svelte-i4b7hv"),E(u,"data-row",t[1]),E(u,"data-col",t[0]),u.value=r=t[2].formula||"",E(o,"class","value svelte-i4b7hv"),E(o,"tabindex","-1"),o.readOnly=!0,E(o,"data-row",t[1]),E(o,"data-col",t[0]),o.value=t[3],E(a,"class","cell svelte-i4b7hv")},m(e,r,c){var p,f,y,h;v(e,a,r),s(a,u),s(a,n),s(a,o),c&&i(),f="change",y=function(){l(t[2].update)&&t[2].update.apply(this,arguments)},(p=u).addEventListener(f,y,h),i=()=>p.removeEventListener(f,y,h)},p(e,[a]){t=e,2&a&&E(u,"data-row",t[1]),1&a&&E(u,"data-col",t[0]),4&a&&r!==(r=t[2].formula||"")&&u.value!==r&&(u.value=r),2&a&&E(o,"data-row",t[1]),1&a&&E(o,"data-col",t[0]),8&a&&o.value!==t[3]&&(o.value=t[3])},i:e,o:e,d(e){e&&c(a),i()}}}function et(e,t,a){let{col:u}=t,{row:r}=t,n=new ze({onUpdate:(e,t)=>{a(2,n=t);const l="symbol"==typeof n.value.value?n.value.value.toString():n.value.value;console.log(`Cell ${r},${u} updated; ${l}`)},row:r,col:u,allowUnsafe:!0}),l="";return A(n.destroy),e.$set=e=>{"col"in e&&a(0,u=e.col),"row"in e&&a(1,r=e.row)},e.$$.update=()=>{4&e.$$.dirty&&a(3,l="symbol"==typeof n.value.value?n.value.value.toString():n.value.value)},[u,r,n,l]}class tt extends B{constructor(e){super(),V(this,e,et,Je,o,{col:0,row:1})}}function at(e,t,a){const u=e.slice();return u[1]=t[a],u[5]=a,u}function ut(e,t,a){const u=e.slice();return u[1]=t[a],u[3]=a,u}function rt(e,t,a){const u=e.slice();return u[1]=t[a],u[5]=a,u}function nt(t){let a,u,r=String.fromCharCode(t[5]+65)+"";return{c(){a=f("th"),u=y(r)},m(e,t){v(e,a,t),s(a,u)},p:e,d(e){e&&c(a)}}}function lt(t){let a,u;const r=new tt({props:{col:t[5],row:t[3]}});return{c(){var e;a=f("td"),(e=r.$$.fragment)&&e.c()},m(e,t){v(e,a,t),x(r,a,null),u=!0},p:e,i(e){u||(_(r.$$.fragment,e),u=!0)},o(e){U(r.$$.fragment,e),u=!1},d(e){e&&c(a),P(r)}}}function ot(t){let a,u,r,n,l,o,i=t[3]+1+"",E={length:t[0].width},m=[];for(let e=0;e<E.length;e+=1)m[e]=lt(at(t,E,e));return{c(){a=f("tr"),u=f("th"),r=y(i),n=h();for(let e=0;e<m.length;e+=1)m[e].c();l=h()},m(e,t){v(e,a,t),s(a,u),s(u,r),s(a,n);for(let e=0;e<m.length;e+=1)m[e].m(a,null);s(a,l),o=!0},p:e,i(e){if(!o){for(let e=0;e<E.length;e+=1)_(m[e]);o=!0}},o(e){m=m.filter(Boolean);for(let e=0;e<m.length;e+=1)U(m[e]);o=!1},d(e){e&&c(a),p(m,e)}}}function st(e){let t,a,u,n,l,o,i,y,m,d,A,g={length:e[0].width},S=[];for(let t=0;t<g.length;t+=1)S[t]=nt(rt(e,g,t));let M={length:e[0].height},I=[];for(let t=0;t<M.length;t+=1)I[t]=ot(ut(e,M,t));const T=e=>U(I[e],1,1,()=>{I[e]=null});return{c(){t=f("main"),a=f("h1"),a.textContent="Table demo",u=h(),n=f("table"),l=f("thead"),o=f("tr"),i=f("th"),y=h();for(let e=0;e<S.length;e+=1)S[e].c();m=h(),d=f("tbody");for(let e=0;e<I.length;e+=1)I[e].c();E(a,"class","svelte-1tky8bj"),E(t,"class","svelte-1tky8bj")},m(e,r){v(e,t,r),s(t,a),s(t,u),s(t,n),s(n,l),s(l,o),s(o,i),s(o,y);for(let e=0;e<S.length;e+=1)S[e].m(o,null);s(n,m),s(n,d);for(let e=0;e<I.length;e+=1)I[e].m(d,null);A=!0},p(e,[t]){if(0&t){let a;for(g={length:e[0].width},a=0;a<g.length;a+=1){const u=rt(e,g,a);S[a]?S[a].p(u,t):(S[a]=nt(u),S[a].c(),S[a].m(o,null))}for(;a<S.length;a+=1)S[a].d(1);S.length=g.length}if(1&t){let a;for(M={length:e[0].height},a=0;a<M.length;a+=1){const u=ut(e,M,a);I[a]?(I[a].p(u,t),_(I[a],1)):(I[a]=ot(u),I[a].c(),_(I[a],1),I[a].m(d,null))}for(D={r:0,c:[],p:D},a=M.length;a<I.length;a+=1)T(a);D.r||r(D.c),D=D.p}},i(e){if(!A){for(let e=0;e<M.length;e+=1)_(I[e]);A=!0}},o(e){I=I.filter(Boolean);for(let e=0;e<I.length;e+=1)U(I[e]);A=!1},d(e){e&&c(t),p(S,e),p(I,e)}}}function vt(e){return[{width:3,height:3}]}return new class extends B{constructor(e){super(),V(this,e,vt,st,o,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
